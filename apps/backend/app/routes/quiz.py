from fastapi import APIRouter, Depends, HTTPException, Query
from random import sample, shuffle
from typing import List, Dict, Any
from uuid import uuid4
from datetime import datetime

from sqlalchemy.orm import Session

from app.routes.auth_ext import get_current_user
from app.models import User, Progress
from app.db import get_db
from app.core.learning_data import get_resources, get_learning_path

router = APIRouter()


def _question(
    question: str,
    options: List[str],
    answer: int,
    *,
    difficulty: str,
    mode: str,
    explanation: str,
    skill: str,
) -> Dict[str, Any]:
    return {
        "id": str(uuid4()),
        "question": question,
        "options": options,
        "answer": answer,
        "difficulty": difficulty,
        "mode": mode,
        "explanation": explanation,
        "skill": skill,
    }


DIFFICULTY_SETTINGS: Dict[str, Dict[str, int]] = {
    "beginner": {"time_per_question": 75, "points": 10},
    "intermediate": {"time_per_question": 60, "points": 20},
    "advanced": {"time_per_question": 45, "points": 30},
}


def _multi_mode_questions(data: List[Dict[str, Any]]) -> List[Dict[str, Any]]:
    return [
        _question(
            item["question"],
            item["options"],
            item["answer"],
            difficulty=item["difficulty"],
            mode=item["mode"],
            explanation=item["explanation"],
            skill=item["skill"],
        )
        for item in data
    ]


_QUESTION_BANK: Dict[str, Dict[str, List[Dict[str, Any]]]] = {
    "AI/ML": {
        "concept": _multi_mode_questions(
            [
                {
                    "question": "What is overfitting in machine learning?",
                    "options": [
                        "The model is too simple and underfits",
                        "The model memorizes noise in the training set",
                        "The model uses dropout layers",
                        "The model has a low variance",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "Overfitting occurs when a model learns the noise of the training data and performs poorly on unseen data.",
                    "skill": "Model Evaluation",
                },
                {
                    "question": "Why do we keep a validation set separate from the test set?",
                    "options": [
                        "To improve GPU utilization",
                        "To tune hyperparameters without touching the test set",
                        "To generate more training data",
                        "To reduce inference latency",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "Validation data helps tune hyperparameters while keeping the test set pristine for the final unbiased evaluation.",
                    "skill": "Experiment Discipline",
                },
                {
                    "question": "Which library is most commonly used for building deep learning models in Python?",
                    "options": ["Scikit-learn", "TensorFlow", "Pandas", "Matplotlib"],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "TensorFlow (and its high-level API Keras) is widely used for constructing deep learning architectures.",
                    "skill": "Tooling",
                },
                {
                    "question": "Which technique helps prevent exploding gradients in deep neural networks?",
                    "options": ["Batch normalization", "Gradient clipping", "Dropout", "Early stopping"],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "Gradient clipping caps gradient magnitudes so they do not grow uncontrollably during backpropagation.",
                    "skill": "Optimization",
                },
                {
                    "question": "What does the Adam optimizer provide compared to vanilla SGD?",
                    "options": [
                        "Momentum and adaptive learning rates per parameter",
                        "Only decreases memory usage",
                        "Eliminates the need for backpropagation",
                        "Requires no hyperparameter tuning",
                    ],
                    "answer": 0,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "Adam combines momentum with adaptive learning rates, leading to faster convergence in many settings.",
                    "skill": "Optimization",
                },
                {
                    "question": "Which evaluation metric is often preferred for highly imbalanced classification problems?",
                    "options": ["Accuracy", "Recall", "Mean Absolute Error", "Adjusted R-Squared"],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "Recall highlights the ability to capture the minority class, which is typically crucial in imbalanced datasets.",
                    "skill": "Model Evaluation",
                },
                {
                    "question": "What does a ROC curve plot?",
                    "options": [
                        "Precision vs. recall",
                        "True positive rate vs. false positive rate",
                        "Accuracy vs. loss",
                        "Precision vs. specificity",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "ROC curves visualize the trade-off between true positive rate and false positive rate across thresholds.",
                    "skill": "Model Evaluation",
                },
                {
                    "question": "Why might you prefer F1-score over accuracy when reporting a model's performance?",
                    "options": [
                        "It ignores the minority class",
                        "It balances precision and recall in imbalanced settings",
                        "It is easier to compute",
                        "It only cares about recall",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "F1-score combines precision and recall, providing a balanced metric when classes are imbalanced.",
                    "skill": "Model Evaluation",
                },
                {
                    "question": "Which statement best differentiates batch learning from online learning?",
                    "options": [
                        "Batch learning updates weights with each new sample",
                        "Online learning updates incrementally; batch learning trains on fixed datasets",
                        "Batch learning requires reinforcement learning",
                        "Online learning cannot handle streaming data",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "Batch learning trains on a fixed dataset, whereas online learning updates incrementally as new data streams in.",
                    "skill": "Learning Paradigms",
                },
                {
                    "question": "Which activation function helps mitigate vanishing gradients in deep networks?",
                    "options": ["Sigmoid", "ReLU", "Softmax", "Hard tanh"],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "ReLU preserves gradients better than saturating functions like sigmoid, easing training of deep networks.",
                    "skill": "Neural Networks",
                },
                {
                    "question": "What is feature scaling used for in machine learning pipelines?",
                    "options": [
                        "To encode categorical features into numbers",
                        "To normalize feature ranges so distance-based models behave properly",
                        "To remove duplicate columns",
                        "To reduce overfitting in ensembles",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "Scaling keeps feature magnitudes comparable, which is critical for models using distance or gradient-based updates.",
                    "skill": "Feature Engineering",
                },
                {
                    "question": "Which regularization technique adds the absolute value of coefficients to the loss function?",
                    "options": ["Ridge", "Lasso", "Elastic Net", "Dropout"],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "Lasso adds an L1 penalty, shrinking some coefficients to zero and enabling feature selection.",
                    "skill": "Regularization",
                },
                {
                    "question": "Why do we use cross-validation during model selection?",
                    "options": [
                        "To reduce inference latency",
                        "To evaluate stability across different splits of the data",
                        "To increase dataset size",
                        "To avoid feature scaling",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "Cross-validation checks performance across multiple folds, giving a robust estimate of generalization.",
                    "skill": "Model Validation",
                },
                {
                    "question": "What is the main goal of dimensionality reduction?",
                    "options": [
                        "Increase storage requirements",
                        "Simplify data to essential features while preserving structure",
                        "Remove outliers automatically",
                        "Improve GPU utilization",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "Dimensionality reduction compresses data into fewer features, aiding visualization and reducing noise.",
                    "skill": "Feature Engineering",
                },
                {
                    "question": "Which metric is common for evaluating regression models?",
                    "options": ["F1-score", "Recall", "Root Mean Squared Error", "Silhouette score"],
                    "answer": 2,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "RMSE measures the average magnitude of error between predictions and actual numerical values.",
                    "skill": "Model Evaluation",
                },
                {
                    "question": "What does early stopping help prevent?",
                    "options": [
                        "Underfitting due to small models",
                        "Overfitting by halting training when validation loss worsens",
                        "Feature leakage",
                        "Model interpretability issues",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "Early stopping terminates training when validation performance degrades, preventing over-training.",
                    "skill": "Optimization",
                },
                {
                    "question": "What is a confusion matrix used for?",
                    "options": [
                        "Visualizing distribution of a numeric feature",
                        "Summarizing classification results by predicted vs. actual labels",
                        "Calculating regression error",
                        "Reducing dimensionality",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "A confusion matrix details true positives, false positives, true negatives, and false negatives for model assessment.",
                    "skill": "Model Evaluation",
                },
                {
                    "question": "Which clustering algorithm groups points based on density?",
                    "options": ["K-means", "DBSCAN", "Hierarchical agglomerative", "Gaussian mixture"],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "DBSCAN forms clusters from dense regions without requiring a pre-set number of clusters.",
                    "skill": "Unsupervised Learning",
                },
                {
                    "question": "What is transfer learning primarily used for?",
                    "options": [
                        "Training models from scratch",
                        "Leveraging pre-trained representations for new tasks",
                        "Improving data labeling pipelines",
                        "Compressing models for mobile deployment",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "Transfer learning reuses weight representations learned from large datasets to accelerate new tasks.",
                    "skill": "Deep Learning",
                },
                {
                    "question": "Which technique helps models remain calibrated on streaming data?",
                    "options": [
                        "Gradient accumulation",
                        "Model distillation",
                        "Scheduled re-training and drift monitoring",
                        "Batch normalization",
                    ],
                    "answer": 2,
                    "difficulty": "advanced",
                    "mode": "concept",
                    "explanation": "Scheduled retraining with drift detection ensures models adapt to evolving data distributions.",
                    "skill": "MLOps Monitoring",
                },
            ]
        ),
        "interview": _multi_mode_questions(
            [
                {
                    "question": "Explain the bias-variance trade-off to a non-technical stakeholder.",
                    "options": [
                        "Models need as many features as possible to be accurate",
                        "Simpler models can miss patterns (bias) while complex ones can overfit noise (variance)",
                        "Training longer always reduces both bias and variance",
                        "Variance is irrelevant when using neural networks",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "Communicate that underfitting and overfitting sit on opposite ends, and tuning finds the sweet spot.",
                    "skill": "Communication",
                },
                {
                    "question": "How would you explain regularization to a project manager?",
                    "options": [
                        "It increases the dataset size",
                        "It penalizes overly complex models to keep them generalizable",
                        "It removes the need for validation data",
                        "It guarantees perfect accuracy",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "Regularization discourages extreme parameter values, preventing models from memorizing noise.",
                    "skill": "Regularization",
                },
                {
                    "question": "Describe in plain language what a confusion matrix tells you.",
                    "options": [
                        "How long training will take",
                        "How many predictions fell into correct vs. incorrect categories",
                        "Why a model failed to converge",
                        "Which features were most important",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "interview",
                    "explanation": "A confusion matrix outlines correct and incorrect predictions, highlighting common misclassifications.",
                    "skill": "Communication",
                },
                {
                    "question": "How do you handle class imbalance when presenting results to leadership?",
                    "options": [
                        "Ignore the imbalance",
                        "Focus on metrics like recall, precision, and AUC instead of accuracy",
                        "Report only training loss curves",
                        "Deploy without adjustment",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "Communicate the relevance of recall, precision, and F1, explaining why accuracy is misleading.",
                    "skill": "Model Evaluation",
                },
                {
                    "question": "Explain gradient descent to someone without a math background.",
                    "options": [
                        "It's a method for encrypting gradients before sharing",
                        "It's like walking downhill step-by-step to reach the lowest point of error",
                        "It's a method to store gradients",
                        "It's a way to make features independent",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "interview",
                    "explanation": "Use analogies such as descending a hill by taking steps in the steepest slope direction.",
                    "skill": "Optimization",
                },
                {
                    "question": "How would you justify investing in experiment tracking tools to leadership?",
                    "options": [
                        "They slow teams down",
                        "They provide reproducibility and audit trails for model decisions",
                        "They replace the need for monitoring",
                        "They eliminate data drift",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "interview",
                    "explanation": "Highlight traceability, enabling quicker debugging and compliance evidence.",
                    "skill": "MLOps Process",
                },
                {
                    "question": "Compare bagging and boosting in practical terms.",
                    "options": [
                        "Bagging builds models sequentially; boosting builds in parallel",
                        "Bagging reduces variance by training models on resampled data; boosting reduces bias by focusing on mistakes",
                        "Bagging only works with trees",
                        "Boosting does not require hyperparameter tuning",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "Use everyday analogies: bagging averages independent opinions, boosting refines by learning from errors.",
                    "skill": "Ensemble Methods",
                },
                {
                    "question": "How do you explain feature importance scores to business stakeholders?",
                    "options": [
                        "They show which inputs the model relies on most for predictions",
                        "They guarantee causal impact",
                        "They reveal which features were missing",
                        "They only apply to deep learning models",
                    ],
                    "answer": 0,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "Clarify that feature importance indicates influence on predictions, though not necessarily causation.",
                    "skill": "Explainability",
                },
                {
                    "question": "Explain transfer learning in a single sentence for a stakeholder update.",
                    "options": [
                        "It means training multiple models at once",
                        "It reuses knowledge from pre-trained models to speed up new tasks",
                        "It guarantees no overfitting",
                        "It removes the need for labeled data",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "interview",
                    "explanation": "Focus on the benefit: faster training by using pre-trained representations.",
                    "skill": "Deep Learning",
                },
                {
                    "question": "How would you describe model drift to an executive?",
                    "options": [
                        "A model being deployed for too long",
                        "When real-world data changes so the model's assumptions no longer hold",
                        "A regularization technique",
                        "A concept exclusive to image models",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "Convey that evolving data can erode performance, requiring monitoring and retraining.",
                    "skill": "MLOps Monitoring",
                },
                {
                    "question": "How do you explain the benefits of automated feature stores to product leadership?",
                    "options": [
                        "They slow down experimentation",
                        "They provide consistent, reusable, and audited features for multiple teams",
                        "They replace the data warehouse",
                        "They eliminate the need for documentation",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "interview",
                    "explanation": "Feature stores ensure teams share validated features, reducing duplication and errors.",
                    "skill": "Data Platforms",
                },
                {
                    "question": "What analogy would you use to explain hyperparameter tuning?",
                    "options": [
                        "It's like picking the right recipe ingredients and baking time",
                        "It removes randomness from training",
                        "It guarantees 100% accuracy",
                        "It replaces the need for data cleaning",
                    ],
                    "answer": 0,
                    "difficulty": "beginner",
                    "mode": "interview",
                    "explanation": "Analogies help stakeholders appreciate the search for best configuration for the model.",
                    "skill": "Optimization",
                },
                {
                    "question": "Tell me how you ensure responsible AI practices in a project.",
                    "options": [
                        "Ignore fairness concerns",
                        "Include bias checks, explainability, and human review where needed",
                        "Deploy as fast as possible",
                        "Keep models entirely black-box",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "interview",
                    "explanation": "Responsible AI involves evaluating bias, documenting assumptions, and providing transparency.",
                    "skill": "AI Governance",
                },
                {
                    "question": "How would you justify the cost of model monitoring tools?",
                    "options": [
                        "They provide early detection of issues that could cost more if left unnoticed",
                        "They offer no measurable benefit",
                        "They replace the need for experimentation",
                        "They guarantee regulatory compliance automatically",
                    ],
                    "answer": 0,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "Monitoring tools catch performance regressions early, protecting customer experience.",
                    "skill": "MLOps Monitoring",
                },
                {
                    "question": "Explain to a recruiter the difference between precision and recall.",
                    "options": [
                        "Precision is about catching positives; recall is about avoiding false alarms",
                        "Precision measures how many predicted positives were correct, recall measures how many actual positives were found",
                        "They are identical metrics",
                        "Recall is irrelevant in imbalanced datasets",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "interview",
                    "explanation": "Break down the metrics in plain language with an example, such as medical testing.",
                    "skill": "Model Evaluation",
                },
                {
                    "question": "How do you convince stakeholders to invest in data quality earlier in the pipeline?",
                    "options": [
                        "Data quality only matters during deployment",
                        "Bad data inflates downstream costs and slows releases; high-quality inputs enable trustworthy models",
                        "Data quality is purely technical debt",
                        "Better to fix data after model deployment",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "interview",
                    "explanation": "Illustrate how upstream quality reduces rework and improves model outcomes.",
                    "skill": "Data Quality",
                },
                {
                    "question": "How would you present explainability results to a compliance partner?",
                    "options": [
                        "Skip the explanation details",
                        "Provide feature impact summaries, example predictions, and documentation of methodologies",
                        "Only share aggregate accuracy",
                        "State that explainability is impossible",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "interview",
                    "explanation": "Combine feature attributions with written context so non-technical teams can audit decisions.",
                    "skill": "Explainability",
                },
                {
                    "question": "What would you say if leadership asks why experimentation is taking longer this quarter?",
                    "options": [
                        "We are intentionally running more rigorous validation and ablation studies",
                        "We are ignoring process improvements",
                        "The models are already optimal",
                        "Data volume has nothing to do with timelines",
                    ],
                    "answer": 0,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "Frame deliberate experimentation as a quality investment, supported by metrics.",
                    "skill": "Experiment Discipline",
                },
                {
                    "question": "Describe model calibration in business-friendly terms.",
                    "options": [
                        "It is the process of optimizing runtime",
                        "It ensures predicted probabilities align with real-world outcomes",
                        "It increases the number of features",
                        "It removes the need for monitoring",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "interview",
                    "explanation": "Calibration aligns confidence estimates with actual likelihoods, improving decision trust.",
                    "skill": "Model Evaluation",
                },
                {
                    "question": "Explain the benefit of A/B testing a new model before production rollout.",
                    "options": [
                        "It replaces offline validation",
                        "It compares performance on live traffic to ensure improvements hold up",
                        "It guarantees no regressions",
                        "It only slows releases",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "A/B testing validates that the new model performs better with real users before full rollout.",
                    "skill": "Model Validation",
                },
                {
                    "question": "How do you explain concept drift monitoring to a customer success team?",
                    "options": [
                        "It is a developer-only concern",
                        "We watch for changes in user behavior that could degrade model suggestions",
                        "It predicts server outages",
                        "It removes the need for re-training",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "Connect drift monitoring to customer experience, explaining how it triggers retraining before quality drops.",
                    "skill": "MLOps Monitoring",
                },
            ]
        ),
        "rapid": _multi_mode_questions(
            [
                {
                    "question": "Rapid response: latency for a recommendation model jumps from 50ms to 600ms after a deploy. What is your first check?",
                    "options": [
                        "Disable logging immediately",
                        "Compare the new model’s feature pipeline or external calls for added latency",
                        "Increase batch size",
                        "Ignore until users complain",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Investigate recent changes—feature engineering or downstream services often introduce latency spikes.",
                    "skill": "Production ML",
                },
                {
                    "question": "Rapid triage: your nightly training job fails with 'out of disk space'. First remediation?",
                    "options": [
                        "Increase learning rate",
                        "Purge stale checkpoints or move them to long-term storage",
                        "Disable monitoring",
                        "Retrain with fewer features",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Freeing or relocating artifacts restores the pipeline while investigating root causes.",
                    "skill": "Operational Excellence",
                },
                {
                    "question": "Rapid drill: an API returning model predictions suddenly gives HTTP 500 errors. First action?",
                    "options": [
                        "Ignore and hope it recovers",
                        "Check logs/metrics for recent deploys, roll back or hotfix if necessary",
                        "Increase autoscaling thresholds",
                        "Delete the model",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Review release changes and metrics, then roll back or patch to restore service quickly.",
                    "skill": "Operations",
                },
                {
                    "question": "Rapid fix: monitoring shows precision dropped by 20% overnight, but recall is stable. What do you inspect first?",
                    "options": [
                        "Training hyperparameters",
                        "Recent changes to thresholding or post-processing logic",
                        "GPU utilization metrics",
                        "Feature scaling strategy",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Precision drops often indicate threshold or label-quality issues; start with recent pipeline adjustments.",
                    "skill": "Model Diagnostics",
                },
                {
                    "question": "Rapid response: feature store latency spikes to 2 seconds, causing model SLA breaches. First move?",
                    "options": [
                        "Disable caching",
                        "Inspect feature store health, enable caching or fallback features",
                        "Retrain the model immediately",
                        "Ignore latency alerts",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Focus on the feature store’s performance and failover strategies before adjusting the model.",
                    "skill": "Data Platforms",
                },
                {
                    "question": "Rapid action: a critical experiment dashboard shows missing metrics for today's run. What do you do first?",
                    "options": [
                        "Ignore for now",
                        "Validate that logging hooks executed and storage credentials remain valid",
                        "Retrain the model",
                        "Reduce logging verbosity permanently",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Broken logging pipelines prevent analysis; verify hooks and credentials then re-run if needed.",
                    "skill": "MLOps Process",
                },
                {
                    "question": "Rapid scenario: your prediction service starts returning NaN values. First investigation?",
                    "options": [
                        "Switch from JSON to protobuf",
                        "Inspect preprocessing for divide-by-zero or invalid inputs",
                        "Increase model depth",
                        "Disable validation checks",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "NaNs often originate from upstream preprocessing errors; audit transformations and inputs quickly.",
                    "skill": "Operational Excellence",
                },
                {
                    "question": "Rapid triage: automated monitoring flags a drift score above threshold. Immediate step?",
                    "options": [
                        "Turn off drift detection",
                        "Analyze which features triggered drift and evaluate retraining cadence",
                        "Deploy a larger model",
                        "Ignore until customers complain",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Drill into feature-level drift and plan retraining or threshold adjustments to maintain performance.",
                    "skill": "MLOps Monitoring",
                },
                {
                    "question": "Rapid fix: CI/CD pipeline fails because unit tests for feature transformations suddenly fail. First action?",
                    "options": [
                        "Skip unit tests to unblock deployment",
                        "Review recent data contract or schema changes that broke the tests",
                        "Rollback the monitoring configuration",
                        "Increase the learning rate",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "A schema change likely broke assumptions; align contracts or transformations before redeploying.",
                    "skill": "Data Quality",
                },
                {
                    "question": "Rapid response: a new model uses GPU inference but saturates GPU memory in production. What’s your quick mitigation?",
                    "options": [
                        "Disable batching entirely",
                        "Optimize batch size or move some traffic to CPU fallback",
                        "Retrain the previous model",
                        "Ignore the alerts",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Adjust inference batch size or route overflow traffic to a safe fallback while investigating.",
                    "skill": "Systems Optimization",
                },
                {
                    "question": "Rapid drill: your A/B test shows the new model underperforming with certain user segments. First troubleshooting?",
                    "options": [
                        "Stop the experiment instantly for all users",
                        "Segment metrics to understand which features or cohorts cause regressions",
                        "Increase the learning rate",
                        "Ignore until the test ends",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Segmenting results reveals whether a feature shift or cohort-specific issue drives the underperformance.",
                    "skill": "Model Evaluation",
                },
                {
                    "question": "Rapid response: data labeling job is backlogged, threatening the next training cycle. First mitigation?",
                    "options": [
                        "Cancel labeling",
                        "Prioritize label queues, add workforce or use active learning to focus on most valuable samples",
                        "Retrain with synthetic labels",
                        "Decrease monitoring coverage",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Optimize labeling resources and consider active learning to keep the training schedule on track.",
                    "skill": "Data Operations",
                },
                {
                    "question": "Rapid fix: your batch scoring job misses SLA because of feature engineering steps. What do you check first?",
                    "options": [
                        "Scaler configuration",
                        "Expensive feature joins or transformation UDFs",
                        "Model hyperparameters",
                        "Visualization tooling",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Feature pipelines often dominate runtime; profile joins and UDF performance before blaming the model.",
                    "skill": "Data Platforms",
                },
                {
                    "question": "Rapid triage: a fairness dashboard shows a sudden disparity increase. First course of action?",
                    "options": [
                        "Disable the dashboard",
                        "Investigate recent data distributions and model updates that could affect impacted groups",
                        "Retrain with the same data",
                        "Ignore the disparity metric",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Fairness changes often stem from data shifts or new logic; respond swiftly to maintain compliance.",
                    "skill": "Responsible AI",
                },
                {
                    "question": "Rapid scenario: streaming predictions show elevated 4xx errors from downstream services. Response?",
                    "options": [
                        "Retry endlessly",
                        "Coordinate with the downstream service owners and implement exponential backoff or fallbacks",
                        "Disable monitoring",
                        "Increase GPU memory",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Work with dependent services and add resilience patterns to protect the pipeline.",
                    "skill": "Systems Integration",
                },
                {
                    "question": "Rapid incident: rollback completed but performance remains degraded. What next?",
                    "options": [
                        "Assume it will heal itself",
                        "Check whether data or feature pipelines also need rollback or replays",
                        "Retrain all models immediately",
                        "Disable metrics collection",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Rollbacks must extend to dependent pipelines—verify data snapshots and transformations match the working state.",
                    "skill": "Operations",
                },
                {
                    "question": "Rapid drill: your resource quotas hit limits mid-quarter due to unexpected experiment bursts. Quick mitigation?",
                    "options": [
                        "Stop all experiments",
                        "Enable workload auto-pausing, request temporary quota increase, or shift workloads to spot instances",
                        "Ignore billing alerts",
                        "Delete model artifacts randomly",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Strategically manage workloads and request adjustments to keep teams productive while controlling cost.",
                    "skill": "MLOps Process",
                },
                {
                    "question": "Rapid response: a key metric goes to zero after a schema evolution. First check?",
                    "options": [
                        "Visualization settings",
                        "Verify that field names/types match the updated schema and parsing logic",
                        "Hyperparameter values",
                        "GPU temperature",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Schema changes frequently break downstream processing—confirm transformations align with the new schema.",
                    "skill": "Data Quality",
                },
            ]
        ),
    },
    "Web Development": {
        "concept": _multi_mode_questions(
            [
                {
                    "question": "Which HTML element indicates the main heading of a document?",
                    "options": ["<h1>", "<header>", "<title>", "<main>"],
                    "answer": 0,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "<h1> represents the highest-level heading, important for accessibility and SEO.",
                    "skill": "HTML Semantics",
                },
                {
                    "question": "What does CSS Flexbox primarily help with?",
                    "options": [
                        "Serving API requests",
                        "Aligning and distributing space in a one-dimensional layout",
                        "Optimizing SQL queries",
                        "Encrypting web traffic",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "Flexbox simplifies vertical or horizontal alignment of elements in a container.",
                    "skill": "CSS Layout",
                },
                {
                    "question": "Which HTTP status code indicates a resource was not found?",
                    "options": ["200", "301", "404", "500"],
                    "answer": 2,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "A 404 response means the server could not find the requested resource.",
                    "skill": "Web Fundamentals",
                },
                {
                    "question": "What is the purpose of the `alt` attribute on an `<img>` element?",
                    "options": [
                        "Disable caching",
                        "Provide alternative text for screen readers and when images fail to load",
                        "Change the image dimensions",
                        "Apply CSS styles",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "Alt text improves accessibility and SEO by describing images to non-visual users.",
                    "skill": "Accessibility",
                },
                {
                    "question": "Which JavaScript method converts a JSON string into an object?",
                    "options": ["JSON.stringify", "JSON.parse", "JSON.encode", "JSON.objectify"],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "JSON.parse parses JSON strings into JavaScript objects.",
                    "skill": "JavaScript Basics",
                },
                {
                    "question": "Which header reduces the risk of XSS by restricting script sources?",
                    "options": [
                        "Content-Security-Policy",
                        "Cache-Control",
                        "Accept-Encoding",
                        "Location",
                    ],
                    "answer": 0,
                    "difficulty": "advanced",
                    "mode": "concept",
                    "explanation": "Content Security Policy limits where scripts and other resources can be loaded from.",
                    "skill": "Web Security",
                },
                {
                    "question": "What is the difference between margin and padding in CSS?",
                    "options": [
                        "Margin is inside the element; padding is outside",
                        "Padding is inside the element; margin is the space outside",
                        "They are identical",
                        "Margin affects text only",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "Padding adds space inside the element border; margin adds space outside.",
                    "skill": "CSS Layout",
                },
                {
                    "question": "Which HTML element is best for marking up navigation links?",
                    "options": ["<aside>", "<nav>", "<section>", "<div>"],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "<nav> denotes sections containing navigation links, improving semantics.",
                    "skill": "HTML Semantics",
                },
                {
                    "question": "Why is responsive design important?",
                    "options": [
                        "It increases server costs",
                        "It ensures layouts adapt to various screen sizes, improving usability",
                        "It disables caching",
                        "It replaces accessibility testing",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "Responsive design delivers consistent experiences across devices, vital for user satisfaction.",
                    "skill": "Frontend Best Practices",
                },
                {
                    "question": "What is the difference between `let` and `const` in JavaScript?",
                    "options": [
                        "`let` is block-scoped while `const` has global scope",
                        "`const` prevents reassignment after initialization whereas `let` allows it",
                        "No difference",
                        "`const` variables are function-scoped, `let` is not",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "const variables cannot be reassigned, helping enforce immutability where appropriate.",
                    "skill": "JavaScript Basics",
                },
                {
                    "question": "What does HTTP/2 introduce to improve performance?",
                    "options": [
                        "Plain text requests",
                        "Multiplexed streams over a single TCP connection",
                        "Removal of TLS",
                        "Mandatory cookies",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "concept",
                    "explanation": "HTTP/2 supports multiplexing, header compression, and server push for faster delivery.",
                    "skill": "Web Performance",
                },
                {
                    "question": "Which CSS property creates a grid container?",
                    "options": ["display: block", "display: flex", "display: grid", "display: inline"],
                    "answer": 2,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "display: grid enables two-dimensional layout control with rows and columns.",
                    "skill": "CSS Layout",
                },
                {
                    "question": "What is the role of a service worker in a progressive web app?",
                    "options": [
                        "Manage server-side rendering",
                        "Intercept network requests to enable offline caching and background sync",
                        "Modify DOM styles",
                        "Encrypt TLS traffic",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "concept",
                    "explanation": "Service workers add offline capabilities, push notifications, and caching to PWAs.",
                    "skill": "Web Performance",
                },
                {
                    "question": "Which HTML attribute improves accessibility for form inputs by linking labels?",
                    "options": ["id", "for", "aria-label", "title"],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "Setting label for attribute to match input id associates them for screen readers.",
                    "skill": "Accessibility",
                },
                {
                    "question": "Which bundler optimizes assets for production in a Vite project?",
                    "options": ["Webpack", "Rollup", "Parcel", "Gulp"],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "Vite leverages Rollup under the hood for optimized production builds.",
                    "skill": "Build Tooling",
                },
                {
                    "question": "What is the difference between `==` and `===` in JavaScript?",
                    "options": [
                        "`==` checks value equality with coercion; `===` checks value and type without coercion",
                        "They are identical",
                        "`===` performs assignment",
                        "`==` compares types only",
                    ],
                    "answer": 0,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "Use strict equality (`===`) to avoid implicit type conversions causing bugs.",
                    "skill": "JavaScript Basics",
                },
                {
                    "question": "Which HTML element conveys important text without extra emphasis?",
                    "options": ["<strong>", "<em>", "<mark>", "<p>"],
                    "answer": 0,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "<strong> indicates strong importance, typically rendered in bold and read emphatically by screen readers.",
                    "skill": "HTML Semantics",
                },
                {
                    "question": "What is lazy loading?",
                    "options": [
                        "Loading all assets upfront",
                        "Deferring resource loading until they are needed (e.g., off-screen images)",
                        "Disabling caching",
                        "Reducing server requests",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "Lazy loading improves performance by loading resources when needed, reducing initial payload.",
                    "skill": "Web Performance",
                },
                {
                    "question": "Which approach helps prevent Cross-Site Request Forgery (CSRF)?",
                    "options": [
                        "Storing passwords in cookies",
                        "Using anti-CSRF tokens and same-site cookies",
                        "Disabling HTTPS",
                        "Minifying JavaScript",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "concept",
                    "explanation": "CSRF tokens and same-site cookie policies prevent unauthorized cross-origin requests.",
                    "skill": "Web Security",
                },
                {
                    "question": "What is a DOM?",
                    "options": [
                        "A deployment pipeline",
                        "A programming language",
                        "An in-memory representation of the HTML document structure",
                        "A CSS preprocessor",
                    ],
                    "answer": 2,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "The DOM is the structured representation enabling scripts to manipulate HTML dynamically.",
                    "skill": "Web Fundamentals",
                },
                {
                    "question": "Which approach helps reduce bundle size in modern web apps?",
                    "options": [
                        "Inlining all dependencies",
                        "Code splitting and dynamic imports",
                        "Disabling compression",
                        "Duplicating modules",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "concept",
                    "explanation": "Code splitting loads chunks on demand, reducing initial bundle size.",
                    "skill": "Web Performance",
                },
            ]
        ),
        "interview": _multi_mode_questions(
            [
                {
                    "question": "Explain the benefits of server-side rendering (SSR) to a product manager.",
                    "options": [
                        "SSR removes the need for APIs",
                        "SSR improves initial page load and SEO by delivering pre-rendered markup",
                        "SSR is slower than CSR in every case",
                        "SSR eliminates the need for hydration",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "SSR delivers HTML quickly for better SEO and perceived performance before client-side hydration.",
                    "skill": "Architecture",
                },
                {
                    "question": "How would you describe a design system to non-technical stakeholders?",
                    "options": [
                        "It is just a CSS file",
                        "It is a library of reusable components, patterns, and guidelines ensuring consistent user experiences",
                        "It slows down development",
                        "It replaces QA testing",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "interview",
                    "explanation": "Design systems standardize UI and interactions, improving efficiency and consistency.",
                    "skill": "Frontend Engineering",
                },
                {
                    "question": "How do you explain accessibility’s business value to executives?",
                    "options": [
                        "It only helps a small group",
                        "Accessible products reach more users, reduce legal risk, and improve UX for everyone",
                        "It delays releases without upside",
                        "It is purely a compliance checkbox",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "interview",
                    "explanation": "Accessibility expands markets and protects the brand while improving usability.",
                    "skill": "Accessibility",
                },
                {
                    "question": "How would you communicate the importance of front-end performance budgets?",
                    "options": [
                        "They block new features",
                        "They ensure pages stay fast by limiting bundle size, requests, and render time",
                        "They have no measurable impact",
                        "Only back-end teams need performance budgets",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "interview",
                    "explanation": "Performance budgets guide teams to keep experiences responsive and user-friendly.",
                    "skill": "Web Performance",
                },
                {
                    "question": "Explain to marketing why Progressive Web Apps matter.",
                    "options": [
                        "They are just responsive websites",
                        "PWAs offer app-like offline experiences, push notifications, and home screen installation without app stores",
                        "They replace native apps entirely",
                        "They eliminate accessibility testing",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "PWAs bridge web and app experiences, increasing engagement and reach.",
                    "skill": "Frontend Engineering",
                },
                {
                    "question": "How do you describe REST APIs to a stakeholder?",
                    "options": [
                        "They are server configuration files",
                        "They expose data/resources through stateless HTTP endpoints adhering to a predictable structure",
                        "They guarantee constant uptime",
                        "They are only used in mobile apps",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "interview",
                    "explanation": "REST provides a consistent, resource-oriented API style for integrating frontends with services.",
                    "skill": "API Design",
                },
                {
                    "question": "How would you explain the role of automated testing in web development?",
                    "options": [
                        "It replaces manual testing completely",
                        "It catches regressions early, improves confidence, and speeds up releases",
                        "It is optional overhead",
                        "It eliminates the need for QA",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "Automated tests validate functionality quickly as code evolves.",
                    "skill": "Frontend Engineering",
                },
                {
                    "question": "Explain the benefits of component-driven development to design leadership.",
                    "options": [
                        "It slows the team down",
                        "Components encourage reuse, consistency, and collaboration between design and engineering",
                        "It removes designers from the process",
                        "It is only for React teams",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "interview",
                    "explanation": "Component-driven workflows align design systems with implementation.",
                    "skill": "Frontend Engineering",
                },
                {
                    "question": "How would you justify web accessibility audits to finance?",
                    "options": [
                        "They are a nice-to-have",
                        "Audits identify compliance gaps, prevent costly lawsuits, and enhance inclusivity",
                        "Audits reduce performance",
                        "Audits are optional if you use frameworks",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "interview",
                    "explanation": "Accessibility audits mitigate legal risk and improve product quality.",
                    "skill": "Accessibility",
                },
                {
                    "question": "Describe how code splitting benefits the user experience.",
                    "options": [
                        "It increases load times",
                        "It reduces initial bundle size by loading only necessary code for the current route",
                        "It disables caching",
                        "It requires older browsers",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "interview",
                    "explanation": "Code splitting delays downloading unused code, improving perceived performance.",
                    "skill": "Web Performance",
                },
                {
                    "question": "Explain to stakeholders the difference between unit and end-to-end tests.",
                    "options": [
                        "Unit tests cover full workflows, end-to-end tests cover individual functions",
                        "Unit tests check small pieces of code; end-to-end tests simulate real user scenarios",
                        "They are interchangeable terms",
                        "End-to-end tests replace monitoring",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "interview",
                    "explanation": "Different test levels provide complementary coverage for functionality.",
                    "skill": "Testing Strategy",
                },
                {
                    "question": "How would you explain hydration in modern web frameworks?",
                    "options": [
                        "It's a security feature",
                        "Hydration attaches event listeners to SSR-rendered markup to make it interactive",
                        "It removes CSS",
                        "It increases database throughput",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "Hydration brings server-rendered HTML to life on the client side.",
                    "skill": "Architecture",
                },
                {
                    "question": "Explain the value of linting tools to engineering managers.",
                    "options": [
                        "They only catch syntax errors",
                        "They enforce coding standards and catch issues early, reducing review time",
                        "They decrease code quality",
                        "They replace manual reviews",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "interview",
                    "explanation": "Linting enforces consistency and prevents common mistakes before runtime.",
                    "skill": "Frontend Engineering",
                },
                {
                    "question": "How do you describe Content Delivery Networks (CDNs) to an executive team?",
                    "options": [
                        "They are backup servers",
                        "CDNs cache assets geographically closer to users, reducing latency and bandwidth costs",
                        "They eliminate server configuration",
                        "They handle only HTML",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "CDNs improve site speed and reliability globally.",
                    "skill": "Web Performance",
                },
                {
                    "question": "Explain why progressive enhancement is a resilient design strategy.",
                    "options": [
                        "It focuses on the newest browsers only",
                        "It provides a functional baseline experience and layers advanced features when available",
                        "It removes the need for testing",
                        "It disables accessibility features",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "Progressive enhancement ensures core functionality works everywhere, improving reliability.",
                    "skill": "Frontend Best Practices",
                },
                {
                    "question": "How would you explain GraphQL to an API product owner?",
                    "options": [
                        "It is a database technology",
                        "It allows clients to request exactly the data they need, reducing over-fetching and under-fetching",
                        "It replaces REST entirely",
                        "It only works with React",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "interview",
                    "explanation": "GraphQL provides a flexible query language for APIs tailored to client requirements.",
                    "skill": "API Design",
                },
                {
                    "question": "Explain to operations why observability for front-end applications matters.",
                    "options": [
                        "Browsing issues are minor",
                        "Front-end telemetry reveals real user performance, errors, and feature adoption",
                        "Servers already provide logs",
                        "Observability slows down releases",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "interview",
                    "explanation": "Observability informs user experience improvements and incident response.",
                    "skill": "Monitoring",
                },
                {
                    "question": "Describe the benefit of using TypeScript in a large web application.",
                    "options": [
                        "It guarantees faster runtime",
                        "Static typing catches errors earlier, improves tooling, and documents intent",
                        "It removes build steps",
                        "It replaces testing",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "TypeScript enhances maintainability with static analysis.",
                    "skill": "Frontend Engineering",
                },
                {
                    "question": "How would you explain micro frontends to a CTO?",
                    "options": [
                        "They are microservices for the backend",
                        "They break large UIs into independently deployable front-end pieces maintained by separate teams",
                        "They eliminate the need for orchestration",
                        "They replace design systems",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "interview",
                    "explanation": "Micro frontends scale front-end development by decentralizing ownership.",
                    "skill": "Architecture",
                },
                {
                    "question": "Explain to QA why visual regression testing is valuable.",
                    "options": [
                        "It is redundant",
                        "It automatically detects UI changes that may not break functionality but hurt UX",
                        "It replaces manual exploratory testing",
                        "It slows builds with no benefit",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "Visual tests catch unexpected UI shifts early, preserving brand consistency.",
                    "skill": "Testing Strategy",
                },
            ]
        ),
        "rapid": _multi_mode_questions(
            [
                {
                    "question": "Rapid response: production bundle size jumps by 40% after a deploy. First action?",
                    "options": [
                        "Ignore; bundles can grow",
                        "Analyze bundle stats, identify heavy dependencies, and revert or code split",
                        "Disable linting",
                        "Increase server CPU",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Bundle growth impacts performance; inspect build reports to isolate offenders.",
                    "skill": "Web Performance",
                },
                {
                    "question": "Rapid fix: users report blank pages after deployment. Immediate step?",
                    "options": [
                        "Wait for more reports",
                        "Check error monitoring, revert, and verify build output for missing assets",
                        "Update documentation",
                        "Disable caching",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Blank screens often stem from errors or missing assets; rollback and investigate quickly.",
                    "skill": "Operations",
                },
                {
                    "question": "Rapid drill: Lighthouse scores drop drastically due to render-blocking scripts. Response?",
                    "options": [
                        "Disable Lighthouse",
                        "Defer or async non-critical scripts and evaluate code splitting",
                        "Increase server RAM",
                        "Compress images only",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Blocking scripts delay rendering; optimize loading strategy to restore performance.",
                    "skill": "Web Performance",
                },
                {
                    "question": "Rapid response: CSS regression breaks mobile layout after a commit. First action?",
                    "options": [
                        "Leave it for the next sprint",
                        "Rollback the change or apply a hotfix and add visual regression coverage",
                        "Disable responsive design",
                        "Increase viewport size requirement",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Revert or patch quickly to restore mobile usability, then prevent recurrence.",
                    "skill": "CSS Architecture",
                },
                {
                    "question": "Rapid fix: API requests start returning CORS errors after configuration changes. Immediate step?",
                    "options": [
                        "Disable CORS checking in the browser",
                        "Adjust server CORS settings to include required origins/methods",
                        "Switch to HTTP",
                        "Force reload the page",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Correct server-side CORS rules to allow intended cross-origin requests.",
                    "skill": "Operations",
                },
                {
                    "question": "Rapid response: a third-party script blocks rendering due to network outages. What do you do?",
                    "options": [
                        "Remove the script entirely",
                        "Load the script asynchronously or defer, add fallbacks, and consider self-hosting",
                        "Increase bundle size",
                        "Disable monitoring",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Third-party failures shouldn't block rendering; load asynchronously with fallbacks.",
                    "skill": "Web Performance",
                },
                {
                    "question": "Rapid drill: error monitoring shows an explosion of `undefined is not a function` after deploy. First move?",
                    "options": [
                        "Ignore—it might be users",
                        "Rollback the release and inspect build/bundle for incompatible changes",
                        "Disable TypeScript",
                        "Clear CDN cache only",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Regression introduced a runtime error; revert and debug quickly.",
                    "skill": "Operations",
                },
                {
                    "question": "Rapid response: analytics show a spike in layout shift (CLS) after new hero images. Next step?",
                    "options": [
                        "Ignore; CLS isn't important",
                        "Reserve space via width/height attributes or aspect ratio and optimize image loading",
                        "Disable Lazy loading",
                        "Replace images with text only",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Layout shifts harm UX; pre-allocate image space to maintain stability.",
                    "skill": "Web Performance",
                },
                {
                    "question": "Rapid fix: production build fails because of a missing environment variable. Immediate course?",
                    "options": [
                        "Hardcode the variable",
                        "Abort deploy, set the variable securely in CI/CD, and replay the pipeline",
                        "Disable environment checks",
                        "Deploy without the variable",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Ensure required environment configuration exists before redeploying.",
                    "skill": "Operations",
                },
                {
                    "question": "Rapid response: user session tokens expire too quickly after an auth change. First step?",
                    "options": [
                        "Tell users to re-login frequently",
                        "Adjust token TTL configuration and redeploy after testing",
                        "Disable authentication",
                        "Switch frameworks",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Misconfigured session lifetimes degrade UX; tune auth settings carefully.",
                    "skill": "Operations",
                },
                {
                    "question": "Rapid drill: your CDN reports increased 5xx responses after a cache purge. Response?",
                    "options": [
                        "Ignore the errors",
                        "Check origin health, review purge scope, and consider rolling back the purge",
                        "Increase cache TTL only",
                        "Disable CDN logging",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Purges can overload origins; ensure infrastructure handles the request surge.",
                    "skill": "Web Performance",
                },
                {
                    "question": "Rapid fix: accessibility tests reveal broken keyboard navigation on a new modal. Next action?",
                    "options": [
                        "Ignore until QA finds more issues",
                        "Fix focus trapping and ARIA roles immediately before release",
                        "Disable modal functionality",
                        "Reduce test coverage",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Accessibility defects degrade usability; correct focus management promptly.",
                    "skill": "Accessibility",
                },
                {
                    "question": "Rapid response: source map uploads to error monitoring failed, obscuring stack traces. First move?",
                    "options": [
                        "Ignore; stack traces aren't needed",
                        "Re-upload correct source maps, verify release tagging, and reprocess errors",
                        "Disable monitoring",
                        "Add more console logs",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Source maps enable debugging; fix uploads to restore readable traces.",
                    "skill": "Operations",
                },
                {
                    "question": "Rapid drill: build pipeline fails after Node version upgrade. Immediate action?",
                    "options": [
                        "Force deploy with old bundles",
                        "Pin the previous Node version temporarily and investigate incompatibilities",
                        "Disable package-lock files",
                        "Re-run indefinitely",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Revert environment change and audit dependencies for compatibility.",
                    "skill": "Operations",
                },
                {
                    "question": "Rapid fix: error monitoring shows spike in 404s due to route changes. What now?",
                    "options": [
                        "Ignore—they are just logs",
                        "Add redirects or update client routing to match new URLs",
                        "Disable router",
                        "Clear browser cache",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "rapid",
                    "explanation": "Implement redirects or adjust routes to maintain link integrity.",
                    "skill": "Operations",
                },
                {
                    "question": "Rapid response: new feature drastically increases CPU usage in server-side rendering. First step?",
                    "options": [
                        "Ignore CPU usage",
                        "Profile SSR code for blocking operations and optimize or cache results",
                        "Disable SSR permanently",
                        "Reduce TTFB metrics",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Hotspots in SSR must be optimized or cached to maintain performance.",
                    "skill": "Web Performance",
                },
                {
                    "question": "Rapid drill: customers cannot download exported reports after a release. Next step?",
                    "options": [
                        "Wait for logs",
                        "Revert or hotfix the release, check permissions and file generation pipeline",
                        "Increase storage quota",
                        "Disable reports permanently",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Restore functionality quickly and diagnose pipeline or permission changes.",
                    "skill": "Operations",
                },
                {
                    "question": "Rapid fix: static assets return stale content despite deploy. First action?",
                    "options": [
                        "Ask users to hard refresh only",
                        "Bust caches via versioned filenames or purge CDN caches appropriately",
                        "Remove asset caching",
                        "Switch CDNs",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Versioning and cache purges ensure users receive updated assets.",
                    "skill": "Web Performance",
                },
                {
                    "question": "Rapid response: real-user monitoring shows a region-specific slowdown. Next move?",
                    "options": [
                        "Reduce all metrics globally",
                        "Investigate CDN edge, DNS, or third-party dependencies impacting that region",
                        "Disable monitoring in that region",
                        "Add more console logs",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Regional slowdowns often tie to CDN or regional dependencies; inspect and optimize targeted infrastructure.",
                    "skill": "Monitoring",
                },
                {
                    "question": "Rapid drill: login flow fails after identity provider certificate rotation. Immediate action?",
                    "options": [
                        "Tell users to try later",
                        "Update the identity provider certificate configuration and redeploy",
                        "Disable MFA",
                        "Clear cookies worldwide",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Synchronize certificate changes to restore authentication flow quickly.",
                    "skill": "Operations",
                },
                {
                    "question": "Rapid response: lighthouse reveals render-blocking fonts after a new typography update. Fix?",
                    "options": [
                        "Remove custom fonts entirely",
                        "Use font-display strategies, preload critical fonts, and subset where possible",
                        "Disable typography",
                        "Increase font size only",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Optimizing font loading maintains fast rendering while preserving design.",
                    "skill": "Web Performance",
                },
            ]
        ),
    },
    "Cybersecurity": {
        "concept": _multi_mode_questions(
            [
                {
                    "question": "What is the main goal of a firewall?",
                    "options": [
                        "Encrypt all data at rest",
                        "Block or allow traffic based on security rules between networks",
                        "Accelerate routing performance",
                        "Manage user passwords centrally",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "Firewalls inspect traffic at network boundaries, enforcing policies to prevent unauthorized access.",
                    "skill": "Network Security",
                },
                {
                    "question": "Which protocol secures HTTP traffic by default?",
                    "options": ["HTTP", "FTP", "HTTPS", "Telnet"],
                    "answer": 2,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "HTTPS wraps HTTP with TLS, providing confidentiality and integrity for web traffic.",
                    "skill": "Web Security",
                },
                {
                    "question": "What is the principle of least privilege?",
                    "options": [
                        "Grant every user admin rights",
                        "Give users only the permissions necessary to perform their duties",
                        "Disable logging for performance",
                        "Share credentials to speed onboarding",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "Least privilege minimizes risk by restricting access to necessary resources only.",
                    "skill": "Access Management",
                },
                {
                    "question": "Which security model assumes no implicit trust within the network?",
                    "options": ["Castle-and-moat", "Zero Trust", "Hub-and-spoke", "Multitenancy"],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "Zero Trust requires verification of every access attempt regardless of network location.",
                    "skill": "Security Architecture",
                },
                {
                    "question": "What does multi-factor authentication (MFA) provide?",
                    "options": [
                        "Faster password resets",
                        "Additional layers of identity verification beyond passwords",
                        "Automatic encryption of data",
                        "Guaranteed prevention of phishing",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "MFA combines factors (something you know, have, are) to strengthen authentication.",
                    "skill": "Identity & Access Management",
                },
                {
                    "question": "Which practice helps prevent SQL injection?",
                    "options": [
                        "Storing plain text passwords",
                        "Parameterized queries and input validation",
                        "Disabling encryption",
                        "Relying on client-side filtering only",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "Parameterized queries ensure user input isn’t executed as part of SQL commands.",
                    "skill": "Application Security",
                },
                {
                    "question": "What is the purpose of a SIEM platform?",
                    "options": [
                        "Encrypt database communications",
                        "Aggregate and correlate security events for monitoring and response",
                        "Balance network traffic",
                        "Provision user accounts",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "SIEM tools centralize logs, detect anomalies, and support incident investigation.",
                    "skill": "Security Monitoring",
                },
                {
                    "question": "Which protocol secures email delivery between servers?",
                    "options": ["SMTP", "SMTPS", "IMAP", "POP3"],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "SMTPS uses TLS to protect SMTP communication channels.",
                    "skill": "Network Security",
                },
                {
                    "question": "What is a man-in-the-middle attack?",
                    "options": [
                        "Intercepting and potentially altering communication between two parties",
                        "Flooding a server with traffic",
                        "Stealing physical equipment",
                        "Guessing passwords via brute force",
                    ],
                    "answer": 0,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "A man-in-the-middle attack relays or manipulates traffic between victims without their knowledge.",
                    "skill": "Threat Knowledge",
                },
                {
                    "question": "Which option best describes defense in depth?",
                    "options": [
                        "Relying on a single strong firewall",
                        "Layering multiple security controls across endpoints, networks, and applications",
                        "Disabling logging to reduce noise",
                        "Using only antivirus software",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "Defense in depth employs multiple, overlapping defenses to reduce risk.",
                    "skill": "Security Architecture",
                },
                {
                    "question": "What is the purpose of network segmentation?",
                    "options": [
                        "Improve entertainment streaming",
                        "Limit lateral movement by isolating sensitive resources",
                        "Increase wireless coverage",
                        "Reduce hardware costs",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "Segmentation creates boundaries that slow or stop attackers moving through the network.",
                    "skill": "Network Security",
                },
                {
                    "question": "Which cryptographic method uses a single shared key?",
                    "options": ["Symmetric encryption", "Asymmetric encryption", "Hashing", "Digital signature"],
                    "answer": 0,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "Symmetric encryption uses the same key for encryption and decryption.",
                    "skill": "Cryptography",
                },
                {
                    "question": "What is a security baseline?",
                    "options": [
                        "A list of optional recommendations",
                        "The minimum configuration standards to harden systems",
                        "A backup schedule",
                        "A set of firewall IP blocks",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "Baselines define required settings to maintain consistent security posture.",
                    "skill": "Governance",
                },
                {
                    "question": "What is the role of a honeypot?",
                    "options": [
                        "Serve production traffic",
                        "Act as a decoy system to attract attackers for detection and research",
                        "Store critical secrets",
                        "Increase throughput",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "Honeypots lure attackers into controlled environments, revealing techniques.",
                    "skill": "Threat Intelligence",
                },
                {
                    "question": "Which framework outlines functions Identify, Protect, Detect, Respond, and Recover?",
                    "options": ["NIST CSF", "ISO 9001", "ITIL", "COBIT"],
                    "answer": 0,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "The NIST Cybersecurity Framework organizes security activities into those five functions.",
                    "skill": "Security Governance",
                },
                {
                    "question": "What is a zero-day vulnerability?",
                    "options": [
                        "A vulnerability with a known patch",
                        "A previously unknown flaw without a fix available",
                        "A misconfigured firewall",
                        "Social engineering attempt",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "Zero-day vulnerabilities have no published patch, leaving systems exposed.",
                    "skill": "Threat Knowledge",
                },
                {
                    "question": "Why is log retention important for incident response?",
                    "options": [
                        "It slows down systems",
                        "It provides forensic evidence to reconstruct timelines and root causes",
                        "It prevents malware infections",
                        "It replaces backups",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "Logs aid investigations by documenting events leading up to and during incidents.",
                    "skill": "Security Monitoring",
                },
                {
                    "question": "What does TLS provide for network communications?",
                    "options": [
                        "Compression only",
                        "Confidentiality, integrity, and authentication over untrusted networks",
                        "Automatic firewall rules",
                        "DDoS mitigation",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "TLS uses certificates and encryption to secure communications.",
                    "skill": "Network Security",
                },
                {
                    "question": "Which practice helps prevent password reuse attacks?",
                    "options": [
                        "Single factor authentication",
                        "Mandating unique passwords and enforcing breach monitoring",
                        "Disabling account lockouts",
                        "Sharing credentials among admins",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "Unique passwords and breach monitoring reduce credential stuffing impact.",
                    "skill": "Identity & Access Management",
                },
                {
                    "question": "What is the primary purpose of vulnerability scanning?",
                    "options": [
                        "Conduct social engineering",
                        "Identify potential weaknesses before attackers exploit them",
                        "Replace patch management",
                        "Generate firewall rules automatically",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "Scanning surfaces weaknesses so teams can remediate proactively.",
                    "skill": "Security Operations",
                },
            ]
        ),
        "interview": _multi_mode_questions(
            [
                {
                    "question": "Explain zero trust to a business executive in one sentence.",
                    "options": [
                        "It assumes every request could be malicious, so we continually verify users and devices",
                        "It means we trust everyone inside the network",
                        "It removes the need for monitoring",
                        "It is a firewall replacement",
                    ],
                    "answer": 0,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "Zero trust enforces continuous verification, limiting the impact of breaches.",
                    "skill": "Security Architecture",
                },
                {
                    "question": "How would you justify investment in a security operations center (SOC) to leadership?",
                    "options": [
                        "It is optional if we have antivirus",
                        "A SOC provides centralized detection, response, and reduces incident impact through continuous monitoring",
                        "It replaces the need for policies",
                        "It guarantees zero breaches",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "interview",
                    "explanation": "Frame a SOC as the nerve center for responding to threats quickly and efficiently.",
                    "skill": "Security Operations",
                },
                {
                    "question": "Explain the business value of security awareness training.",
                    "options": [
                        "It slows down onboarding",
                        "It reduces human error, phish success, and regulatory risk by empowering employees",
                        "It replaces technical controls",
                        "It is only for technical staff",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "interview",
                    "explanation": "Human factors drive many breaches; training strengthens the organization’s first line of defense.",
                    "skill": "Security Awareness",
                },
                {
                    "question": "How would you describe vulnerability management to a finance partner?",
                    "options": [
                        "It is occasional patching",
                        "It is the continuous process of discovering, prioritizing, and remediating weaknesses to reduce risk",
                        "It removes the need for pentests",
                        "It is purely a compliance checkbox",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "Communicate the iterative cycle of scanning, prioritizing, and patching to avoid costly breaches.",
                    "skill": "Security Operations",
                },
                {
                    "question": "Explain to legal stakeholders why incident response playbooks matter.",
                    "options": [
                        "They are optional documents",
                        "They define roles, communications, and actions, reducing chaos and ensuring compliance during breaches",
                        "They eliminate cyber insurance needs",
                        "They replace testing",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "interview",
                    "explanation": "Playbooks ensure consistent, legally sound responses under pressure.",
                    "skill": "Incident Response",
                },
                {
                    "question": "How would you explain penetration testing to a non-technical manager?",
                    "options": [
                        "It is a compliance-only exercise",
                        "It's hiring ethical hackers to simulate attacks and discover weaknesses before criminals do",
                        "It replaces security monitoring",
                        "It's only for large organizations",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "interview",
                    "explanation": "Penetration tests validate controls by emulating real-world adversaries.",
                    "skill": "Security Assessment",
                },
                {
                    "question": "Describe least privilege in language a project sponsor will understand.",
                    "options": [
                        "We trust employees by giving them all access",
                        "People only get the access they need, reducing the damage from compromised accounts",
                        "It slows down projects intentionally",
                        "It is only for administrators",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "interview",
                    "explanation": "Frame it as constraining blast radius—limiting access limits risk.",
                    "skill": "Access Management",
                },
                {
                    "question": "How do you explain the importance of patch management to operations leaders?",
                    "options": [
                        "Patching can be ignored if antivirus is active",
                        "Applying security updates closes vulnerabilities before attackers exploit them",
                        "Patching automatically increases performance",
                        "Patching eliminates insider threats",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "interview",
                    "explanation": "Emphasize that rapid patching lowers the window of opportunity for attackers.",
                    "skill": "Security Operations",
                },
                {
                    "question": "Explain threat intelligence in a business context.",
                    "options": [
                        "It's a list of random indicators",
                        "It provides actionable insights on evolving adversaries to anticipate and block attacks",
                        "It replaces SOC analysts",
                        "It's only relevant after incidents",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "interview",
                    "explanation": "Threat intelligence informs defensive planning and response strategies.",
                    "skill": "Threat Intelligence",
                },
                {
                    "question": "How would you communicate the benefit of network segmentation to facility owners?",
                    "options": [
                        "It complicates network diagrams",
                        "It isolates critical systems so a breach in one area doesn’t spread everywhere",
                        "It increases cooling requirements",
                        "It replaces firewalls entirely",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "Segmentation limits blast radius of breaches and aids compliance.",
                    "skill": "Network Security",
                },
                {
                    "question": "Explain to HR why background checks complement security controls.",
                    "options": [
                        "They are optional bureaucracy",
                        "They reduce insider risk by verifying trustworthiness before granting access",
                        "They replace monitoring",
                        "They guarantee loyalty",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "interview",
                    "explanation": "Human risk management is part of a holistic security strategy.",
                    "skill": "Security Awareness",
                },
                {
                    "question": "How would you justify continuous phishing simulations to executives?",
                    "options": [
                        "Employees enjoy spam emails",
                        "Simulations build resilience, measure readiness, and reinforce training",
                        "They replace multi-factor authentication",
                        "They guarantee zero breaches",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "Phishing exercises test and improve employee response to real threats.",
                    "skill": "Security Awareness",
                },
                {
                    "question": "Explain why asset inventory is foundational for cybersecurity.",
                    "options": [
                        "Inventory is only for accounting",
                        "You cannot protect what you don’t know exists; inventory informs patching and monitoring",
                        "It replaces vulnerability scanning",
                        "It is irrelevant for cloud environments",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "interview",
                    "explanation": "Asset visibility underpins every other security control.",
                    "skill": "Security Operations",
                },
                {
                    "question": "How do you explain data loss prevention (DLP) to marketing leadership?",
                    "options": [
                        "It slows down marketing campaigns",
                        "It monitors and blocks unauthorized movement of sensitive data",
                        "It encrypts emails automatically",
                        "It eliminates the need for backups",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "DLP prevents accidental or malicious leakage, protecting brand trust.",
                    "skill": "Data Protection",
                },
                {
                    "question": "Describe incident response tabletop exercises to senior leadership.",
                    "options": [
                        "They are optional games",
                        "They are rehearsals that simulate breaches to test readiness, roles, and communication",
                        "They replace documentation",
                        "They are purely technical drills",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "interview",
                    "explanation": "Tabletops reveal gaps and build muscle memory for crisis situations.",
                    "skill": "Incident Response",
                },
                {
                    "question": "How would you discuss cloud shared responsibility with product teams?",
                    "options": [
                        "Cloud providers handle everything",
                        "Providers secure infrastructure; customers configure services securely",
                        "Customers are not responsible for any controls",
                        "Shared responsibility is outdated",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "Clarify the division of security obligations between provider and customer.",
                    "skill": "Cloud Security",
                },
                {
                    "question": "Explain to legal why breach notification workflows must be rehearsed.",
                    "options": [
                        "Legal handles notifications automatically",
                        "Timing and messaging are regulated; rehearsals ensure compliant, coordinated responses",
                        "Notifications can wait indefinitely",
                        "Regulators do not care about timing",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "interview",
                    "explanation": "Practiced workflows reduce legal exposure and maintain trust.",
                    "skill": "Security Governance",
                },
                {
                    "question": "How do you convey the importance of secure coding training to engineering leadership?",
                    "options": [
                        "Developers already know security",
                        "It reduces vulnerabilities introduced during development, lowering remediation costs later",
                        "Training slows releases permanently",
                        "Static analysis removes security bugs automatically",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "Educated developers produce resilient code, minimizing costly fixes.",
                    "skill": "Application Security",
                },
                {
                    "question": "Explain to procurement why third-party risk assessments are essential.",
                    "options": [
                        "Vendors cannot be hacked",
                        "Supply chain partners can introduce risk, so evaluating their controls prevents cascading breaches",
                        "Assessments slow vendor onboarding for no benefit",
                        "Contracts remove liability",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "interview",
                    "explanation": "Third-party assessments reduce supply chain exposure and ensure compliance.",
                    "skill": "Security Governance",
                },
                {
                    "question": "How would you explain IDS vs. IPS to a finance executive?",
                    "options": [
                        "Both block attacks automatically",
                        "IDS detects and alerts, IPS can automatically block malicious activity",
                        "IDS is obsolete, IPS is modern",
                        "Both encrypt network traffic",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "interview",
                    "explanation": "Differentiate detection vs. prevention capabilities clearly.",
                    "skill": "Network Security",
                },
            ]
        ),
        "rapid": _multi_mode_questions(
            [
                {
                    "question": "Rapid response: SIEM alerts note a burst of failed logins followed by a success on a privileged account. First action?",
                    "options": [
                        "Ignore, likely a typo",
                        "Disable the account and investigate for credential compromise immediately",
                        "Reboot the SIEM",
                        "Notify all employees",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "A brute force may have succeeded; contain the account and investigate.",
                    "skill": "Incident Response",
                },
                {
                    "question": "Rapid triage: a web application firewall flags a spike in SQL injection attempts. What do you review first?",
                    "options": [
                        "Disable the WAF rules",
                        "Confirm blocking is working and check application logs for potential bypasses",
                        "Turn off the application",
                        "Reset user passwords",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Ensure countermeasures are effective and inspect logs for any successful injections.",
                    "skill": "Application Security",
                },
                {
                    "question": "Rapid drill: antivirus quarantines ransomware on multiple endpoints. What is your first coordinated step?",
                        "options": [
                        "Ignore if quarantine succeeded",
                        "Isolate affected machines, verify quarantine success, and hunt for lateral movement indicators",
                        "Uninstall antivirus",
                        "Reimage all devices immediately",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Containment and investigation ensure the threat is fully eradicated.",
                    "skill": "Incident Response",
                },
                {
                    "question": "Rapid response: a phishing simulation report shows 30% click rate in finance. Immediate action?",
                    "options": [
                        "Cancel simulations",
                        "Deliver targeted retraining and increase MFA enforcement for the department",
                        "Fire employees",
                        "Disable email",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "High click rates indicate awareness gaps; address with training and layered defenses.",
                    "skill": "Security Awareness",
                },
                {
                    "question": "Rapid fix: vulnerability scan discovers a critical remote code execution flaw on exposed servers. First step?",
                    "options": [
                        "Schedule patching next quarter",
                        "Prioritize emergency patching or mitigation, and consider isolating impacted systems",
                        "Delete the scan results",
                        "Expand attack surface",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Critical remote exploits demand immediate remediation to prevent compromise.",
                    "skill": "Security Operations",
                },
                {
                    "question": "Rapid scenario: you detect outbound traffic to a known command-and-control domain. Response?",
                    "options": [
                        "Allow the connection",
                        "Block the domain, isolate affected hosts, and initiate incident response procedures",
                        "Only notify leadership",
                        "Disable monitoring to reduce noise",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "C2 traffic signals potential compromise—contain and investigate immediately.",
                    "skill": "Incident Response",
                },
                {
                    "question": "Rapid response: SIEM reports disabled logging on critical servers. Next move?",
                    "options": [
                        "Do nothing; logs aren’t important",
                        "Re-enable logging, investigate who disabled it, and review for stealthy activity",
                        "Restart the servers",
                        "Reinstall the SIEM agent",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Logs cut off may indicate intruder activity or misconfiguration; restore and investigate.",
                    "skill": "Security Monitoring",
                },
                {
                    "question": "Rapid drill: an employee reports losing a laptop with sensitive data. First action?",
                    "options": [
                        "Ignore if it's encrypted",
                        "Initiate asset tracking, remote wipe (if possible), and evaluate data exposure",
                        "Disable Wi-Fi company-wide",
                        "Wait for the employee to find it",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Respond swiftly with asset controls and assess the severity of data leakage.",
                    "skill": "Incident Response",
                },
                {
                    "question": "Rapid response: your intrusion detection system reports lateral movement via SMB. Next step?",
                    "options": [
                        "Assume it is internal maintenance",
                        "Isolate suspected hosts, analyze logs for credential theft, and escalate incident response",
                        "Disable SMB permanently",
                        "Restart the domain controller",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Lateral SMB movement often indicates adversary pivoting—contain and investigate quickly.",
                    "skill": "Incident Response",
                },
                {
                    "question": "Rapid fix: certificates for a production API expire tomorrow. Immediate action?",
                    "options": [
                        "Do nothing; downtime is minor",
                        "Generate and install new certificates, coordinating a maintenance window if necessary",
                        "Disable HTTPS",
                        "Delay until the next patch cycle",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Expired certificates cause outages and security warnings; replace them promptly.",
                    "skill": "Operational Security",
                },
                {
                    "question": "Rapid scenario: threat intel warns of active exploitation against your VPN vendor. First move?",
                    "options": [
                        "Ignore until proven",
                        "Review vendor advisories, apply patches or mitigations, and increase monitoring on VPN endpoints",
                        "Switch to a new VPN provider instantly",
                        "Disable all remote access",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Act on intel by patching and monitoring any exposed assets.",
                    "skill": "Threat Intelligence",
                },
                {
                    "question": "Rapid response: DLP triggered on mass export of customer data. Immediate action?",
                    "options": [
                        "Ignore—it’s probably legitimate",
                        "Investigate the user’s intent, block the transfer if unauthorized, and notify incident response",
                        "Disable DLP to reduce alerts",
                        "Delete customer data",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Large data exfiltration attempts require instant containment and review.",
                    "skill": "Data Protection",
                },
                {
                    "question": "Rapid drill: DNS traffic shows exfiltration patterns. Next step?",
                    "options": [
                        "Allow the traffic",
                        "Block suspicious domains, inspect endpoints, and hunt for malware performing DNS tunneling",
                        "Change registrars",
                        "Disable DNS entirely",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "DNS-based exfiltration indicates compromise; containment and investigation are critical.",
                    "skill": "Incident Response",
                },
                {
                    "question": "Rapid response: endpoint detection flags PowerShell executing encoded commands. First move?",
                    "options": [
                        "Ignore—probably admin activity",
                        "Quarantine the endpoint and analyze commands for malicious intent",
                        "Disable PowerShell globally",
                        "Uninstall endpoint detection",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Encoded PowerShell is a common attack technique; isolate and investigate immediately.",
                    "skill": "Incident Response",
                },
                {
                    "question": "Rapid scenario: cloud bucket becomes publicly accessible due to misconfiguration. Immediate step?",
                    "options": [
                        "Leave it as is",
                        "Lock down permissions, rotate exposed keys, and review access logs for misuse",
                        "Delete the bucket without backups",
                        "Disable all cloud accounts",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Public buckets risk data exposure—correct access and assess impact quickly.",
                    "skill": "Cloud Security",
                },
                {
                    "question": "Rapid fix: your MDR provider reports active ransomware on a server. What’s your first action?",
                    "options": [
                        "Wait for more data",
                        "Isolate the server from the network, disable scheduled tasks, and begin remediation steps",
                        "Run disk defrag",
                        "Notify marketing",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Isolation prevents propagation and buys time for analysis.",
                    "skill": "Incident Response",
                },
                {
                    "question": "Rapid response: scheduled vulnerability scan was missed for two cycles. What now?",
                    "options": [
                        "Ignore as low priority",
                        "Run an out-of-band scan, review coverage gaps, and adjust monitoring to prevent recurrence",
                        "Disable scanning entirely",
                        "Switch scanning vendors immediately",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Catch up on missed scans and ensure processes alert when schedules slip.",
                    "skill": "Security Operations",
                },
                {
                    "question": "Rapid drill: encryption keys for a critical database may have been exposed. Key action?",
                    "options": [
                        "Do nothing if keys are old",
                        "Rotate keys, re-encrypt data if necessary, and investigate exposure path",
                        "Change database passwords only",
                        "Disable backups",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Compromised keys invalidate encryption; rotate and assess impact swiftly.",
                    "skill": "Cryptography",
                },
                {
                    "question": "Rapid response: audit finds admins sharing root credentials via email. First remediation?",
                    "options": [
                        "Allow it—admins need speed",
                        "Implement secret management, enforce unique credentials, and retrain on secure handling",
                        "Disable admin accounts",
                        "Switch to shared spreadsheets",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Shared credentials are high risk; enforce proper secret management and policies.",
                    "skill": "Identity & Access Management",
                },
            ]
        ),
    },
    "Data Science": {
        "concept": _multi_mode_questions(
            [
                {
                    "question": "What is the primary goal of exploratory data analysis (EDA)?",
                    "options": [
                        "Train and deploy a final model",
                        "Understand data distributions, patterns, and anomalies before modeling",
                        "Encrypt sensitive data columns",
                        "Reduce labeling costs",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "EDA helps analysts understand dataset structure, spot issues, and inform downstream modeling decisions.",
                    "skill": "Exploratory Analysis",
                },
                {
                    "question": "Which pandas method quickly counts missing values per column?",
                    "options": ["df.describe()", "df.head()", "df.isnull().sum()", "df.memory_usage()"],
                    "answer": 2,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "df.isnull().sum() reveals how many nulls each column contains, a common data quality check.",
                    "skill": "Data Cleaning",
                },
                {
                    "question": "Why is feature scaling important before using k-nearest neighbors?",
                    "options": [
                        "Because KNN relies on distance metrics that are sensitive to feature magnitude",
                        "Because scaling removes outliers automatically",
                        "Because scaling increases model capacity",
                        "Because scaling enables categorical encoding",
                    ],
                    "answer": 0,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "KNN uses distance calculations; unscaled features with large ranges can dominate the metric.",
                    "skill": "Feature Engineering",
                },
                {
                    "question": "What is the primary benefit of storing analytical datasets in Parquet format?",
                    "options": [
                        "It ensures referential integrity between tables",
                        "It provides columnar storage with efficient compression and predicate pushdown",
                        "It encrypts datasets automatically",
                        "It prevents schema evolution issues",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "Parquet’s columnar structure accelerates analytics workloads and reduces storage needs.",
                    "skill": "Data Engineering",
                },
                {
                    "question": "What is the role of the silhouette score in clustering?",
                    "options": [
                        "Evaluate classification accuracy",
                        "Measure how similar data points are to their own cluster versus other clusters",
                        "Determine the number of decision tree leaves",
                        "Assess regression bias",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "Silhouette scores quantify cluster cohesion and separation, guiding cluster quality assessment.",
                    "skill": "Unsupervised Learning",
                },
                {
                    "question": "Which visualization would you choose to compare distributions between two numeric variables?",
                    "options": ["Scatter plot", "Bar chart", "Box plot", "Line chart"],
                    "answer": 0,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "Scatter plots display the relationship between two numerical variables, revealing trends or correlations.",
                    "skill": "Visualization",
                },
                {
                    "question": "Why is data profiling a critical step in analytics projects?",
                    "options": [
                        "It automates model selection",
                        "It uncovers schema issues, outliers, and inconsistencies early in the process",
                        "It eliminates the need for documentation",
                        "It guarantees fair models",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "Profiling surfaces quality problems and patterns that impact downstream modeling and reporting.",
                    "skill": "Data Quality",
                },
                {
                    "question": "Which metric is appropriate for evaluating regression models?",
                    "options": ["Accuracy", "F1-score", "Mean Absolute Error", "Silhouette coefficient"],
                    "answer": 2,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "MAE measures average absolute error between predictions and actual values, suitable for regression.",
                    "skill": "Model Evaluation",
                },
                {
                    "question": "Why might you choose median instead of mean to summarize skewed data?",
                    "options": [
                        "Median is faster to compute",
                        "Median is robust to extreme values, providing a more representative central tendency",
                        "Median is always larger",
                        "Median automatically removes outliers",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "Skewed distributions can distort the mean, whereas the median resists outlier influence.",
                    "skill": "Descriptive Statistics",
                },
                {
                    "question": "Which measure quantifies how a feature is related to another feature linearly?",
                    "options": ["Kurtosis", "Skewness", "Pearson correlation coefficient", "Entropy"],
                    "answer": 2,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "The Pearson correlation coefficient measures linear relationships between numeric features.",
                    "skill": "Statistics",
                },
                {
                    "question": "What is the goal of dimensionality reduction in data science workflows?",
                    "options": [
                        "Increase dimensionality for better performance",
                        "Reduce feature space while preserving important structure or variance",
                        "Automatically remove duplicates",
                        "Ensure models don't need validation",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "Reducing dimensionality simplifies models, improves visualization, and can remove noise.",
                    "skill": "Feature Engineering",
                },
                {
                    "question": "Which algorithm is most appropriate for market basket analysis?",
                    "options": ["Linear regression", "Apriori", "K-means", "Random forest"],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "Apriori mines frequent itemsets, uncovering co-occurrence patterns in transactional data.",
                    "skill": "Association Mining",
                },
                {
                    "question": "What does the elbow method help determine in k-means clustering?",
                    "options": [
                        "Optimal number of clusters",
                        "Learning rate schedule",
                        "Outlier thresholds",
                        "Feature scaling strategy",
                    ],
                    "answer": 0,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "The elbow point suggests a balance between cluster cohesion and number of clusters.",
                    "skill": "Unsupervised Learning",
                },
                {
                    "question": "Why would you perform feature binning on a continuous variable?",
                    "options": [
                        "To make histograms look better",
                        "To capture non-linear relationships or reduce model variance",
                        "To remove missing values automatically",
                        "To speed up SQL queries",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "Binning groups continuous values into categories, aiding interpretability or certain algorithms.",
                    "skill": "Feature Engineering",
                },
                {
                    "question": "Which test would you use to compare two categorical distributions?",
                    "options": ["t-test", "Chi-square test", "ANOVA", "Wilcoxon signed-rank"],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "Chi-square tests whether observed categorical frequencies deviate from expected counts.",
                    "skill": "Statistical Inference",
                },
                {
                    "question": "What is the purpose of a holdout dataset in predictive modeling?",
                    "options": [
                        "To speed up training",
                        "To evaluate final model performance on unseen data",
                        "To generate synthetic samples",
                        "To reduce hyperparameter search",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "A holdout dataset provides an unbiased final evaluation of how the model generalizes.",
                    "skill": "Model Validation",
                },
                {
                    "question": "Which metric is best suited to evaluate a binary classifier with highly imbalanced classes?",
                    "options": ["Accuracy", "ROC-AUC", "Mean Squared Error", "Adjusted R-squared"],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "ROC-AUC or PR-AUC maintain robustness under class imbalance, unlike raw accuracy.",
                    "skill": "Model Evaluation",
                },
                {
                    "question": "What does data normalization typically achieve?",
                    "options": [
                        "It sets all values to zero",
                        "It scales features to a specified range, often 0 to 1, preserving relative relationships",
                        "It removes categorical variables",
                        "It reduces missing values",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "concept",
                    "explanation": "Normalization scales features, improving performance for algorithms sensitive to magnitude.",
                    "skill": "Feature Engineering",
                },
                {
                    "question": "What is the main advantage of using a time-series decomposition?",
                    "options": [
                        "To guarantee seasonality removal",
                        "To separately analyze trend, seasonality, and residual components",
                        "To convert data to categorical",
                        "To avoid feature scaling",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "Decomposing time series isolates underlying patterns for better forecasting insights.",
                    "skill": "Time Series Analysis",
                },
                {
                    "question": "Why is documenting data lineage essential in analytics projects?",
                    "options": [
                        "It speeds up SQL queries",
                        "It provides traceability for audit, reproducibility, and impact analysis",
                        "It guarantees dashboards will never break",
                        "It removes the need for testing",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "concept",
                    "explanation": "Data lineage reveals how data flows and transforms, supporting compliance and debugging.",
                    "skill": "Data Governance",
                },
                {
                    "question": "Which resampling strategy creates multiple bootstrap samples for estimating uncertainty?",
                    "options": ["Holdout split", "k-fold CV", "Bootstrap aggregating", "Time-based split"],
                    "answer": 2,
                    "difficulty": "intermediate",
                    "mode": "concept",
                    "explanation": "Bootstrapping draws samples with replacement to estimate statistics and model stability.",
                    "skill": "Statistics",
                },
            ]
        ),
        "interview": _multi_mode_questions(
            [
                {
                    "question": "How would you explain the value of a data lake to a business stakeholder?",
                    "options": [
                        "It is a place to store only structured data tables",
                        "It centralizes raw and curated data, enabling teams to discover and analyze information faster",
                        "It replaces dashboards entirely",
                        "It removes the need for data governance",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "interview",
                    "explanation": "Describe how data lakes provide flexible storage for diverse data, powering analytics initiatives.",
                    "skill": "Communication",
                },
                {
                    "question": "Explain p-values in simple terms to a marketing manager.",
                    "options": [
                        "They prove the alternative hypothesis",
                        "They estimate how surprising the observed outcome would be if nothing changed",
                        "They measure effect size directly",
                        "They show how large the dataset is",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "interview",
                    "explanation": "Clarify that a low p-value suggests the observed effect is unlikely under the null hypothesis.",
                    "skill": "Statistics",
                },
                {
                    "question": "How do you justify investing time in data cleaning to leadership?",
                    "options": [
                        "Data cleaning can be skipped",
                        "High-quality data reduces downstream rework, improves trust, and speeds delivery",
                        "Data cleaning only benefits analysts",
                        "Cleaning guarantees perfect models",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "Emphasize that reliable data is foundational for accurate insights and decisions.",
                    "skill": "Data Quality",
                },
                {
                    "question": "How would you describe the difference between descriptive and predictive analytics?",
                    "options": [
                        "Descriptive looks at past data, predictive forecasts future outcomes based on patterns",
                        "Both are identical",
                        "Predictive analytics is only for dashboards",
                        "Descriptive analytics is always real-time",
                    ],
                    "answer": 0,
                    "difficulty": "beginner",
                    "mode": "interview",
                    "explanation": "Frame descriptive as understanding the past, predictive as projecting what might happen next.",
                    "skill": "Communication",
                },
                {
                    "question": "Explain to finance partners why feature documentation matters.",
                    "options": [
                        "It's just for compliance",
                        "It clarifies assumptions, transformations, and owners, reducing audit and onboarding friction",
                        "It decreases model accuracy",
                        "It is optional if you use notebooks",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "Documentation increases transparency and speeds collaboration across teams.",
                    "skill": "Data Governance",
                },
                {
                    "question": "How would you communicate the importance of stratified sampling to a recruiter?",
                    "options": [
                        "It lets us sample fewer records",
                        "It ensures samples reflect the same class proportions as the full dataset",
                        "It automatically increases accuracy",
                        "It removes the need for cross-validation",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "interview",
                    "explanation": "Use intuitive examples (e.g., survey demographics) to illustrate balanced sampling.",
                    "skill": "Data Sampling",
                },
                {
                    "question": "Explain the benefit of experimentation platforms to product leadership.",
                    "options": [
                        "They slow down teams",
                        "They ensure consistent tracking, guardrails, and faster iteration on ideas",
                        "They replace user research",
                        "They guarantee higher revenue",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "interview",
                    "explanation": "Platforms provide standardized experiment management, boosting trust in results.",
                    "skill": "Experiment Discipline",
                },
                {
                    "question": "Describe cohort analysis to a sales team.",
                    "options": [
                        "It's a way to cluster leads without labels",
                        "It groups customers based on shared attributes to track behavior over time",
                        "It removes the need for segmentation",
                        "It's only for churn models",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "interview",
                    "explanation": "Explain how cohorts reveal trends and retention patterns within similar user groups.",
                    "skill": "Analytics Storytelling",
                },
                {
                    "question": "How do you explain data drift to operations stakeholders?",
                    "options": [
                        "It's when servers run out of storage",
                        "It's when incoming data changes so existing analytics assumptions no longer hold",
                        "It means the model is broken forever",
                        "It only happens in time-series forecasting",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "Connect drift to business impact—changes in user behavior can mislead dashboards and models.",
                    "skill": "Data Monitoring",
                },
                {
                    "question": "How would you present the ROI of automating ELT pipelines to executives?",
                    "options": [
                        "Automation is a luxury",
                        "It reduces manual effort, prevents errors, and accelerates insights for decision-making",
                        "It increases compliance risk",
                        "It replaces the need for analysts",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "interview",
                    "explanation": "Quantify time savings, consistency improvements, and faster time-to-insight.",
                    "skill": "Data Engineering",
                },
                {
                    "question": "How do you justify building a centralized metrics catalog?",
                    "options": [
                        "It is purely a documentation exercise",
                        "It aligns teams on definitions, reduces conflicting KPI interpretations, and accelerates analysis",
                        "It decreases metric accuracy",
                        "It removes the need for dashboards",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "interview",
                    "explanation": "A metrics catalog clarifies ownership and meaning, preventing misinterpretation.",
                    "skill": "Data Governance",
                },
                {
                    "question": "Explain the difference between correlation and causation to a product owner.",
                    "options": [
                        "Correlated variables always cause each other",
                        "Correlation signals a relationship but not necessarily a cause; causation requires evidence",
                        "Causation is easier to establish than correlation",
                        "They are interchangeable terms",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "interview",
                    "explanation": "Highlight why experiments or domain knowledge are needed to prove causation.",
                    "skill": "Statistics",
                },
                {
                    "question": "How would you communicate the need for data anonymization to compliance teams?",
                    "options": [
                        "It's optional for internal projects",
                        "It protects user privacy, reduces regulatory risk, and allows safe data sharing for analysis",
                        "It decreases model accuracy automatically",
                        "It eliminates the need for access controls",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "interview",
                    "explanation": "Emphasize privacy protection and compliance benefits to gain stakeholder support.",
                    "skill": "Data Governance",
                },
                {
                    "question": "Explain the value of dashboards with drill-down capabilities to customer support.",
                    "options": [
                        "They look nice",
                        "They allow teams to investigate anomalies quickly and respond to customers with evidence",
                        "They replace spreadsheets entirely",
                        "They slow down case resolution",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "interview",
                    "explanation": "Drill-down dashboards empower teams to explore root causes behind metrics.",
                    "skill": "Analytics Storytelling",
                },
                {
                    "question": "How do you describe the benefits of A/B testing to marketing leadership?",
                    "options": [
                        "It delays campaign launches",
                        "It provides statistically reliable evidence to choose the best-performing variant",
                        "It guarantees higher conversions",
                        "It replaces customer research",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "interview",
                    "explanation": "Frame experiments as a method to de-risk decisions with data.",
                    "skill": "Experiment Discipline",
                },
                {
                    "question": "How would you communicate the importance of versioning datasets?",
                    "options": [
                        "Versioning only matters for code",
                        "Versioning ensures reproducibility and traceability when analyses are revisited",
                        "It complicates collaboration",
                        "It eliminates storage costs",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "interview",
                    "explanation": "Dataset versioning prevents confusion and enables audit-ready analytics.",
                    "skill": "Data Governance",
                },
                {
                    "question": "Explain to HR why bias assessments on hiring models are non-negotiable.",
                    "options": [
                        "Bias is unavoidable so it should be ignored",
                        "Assessments surface unfair patterns and ensure compliance with regulations",
                        "Models automatically ensure fairness",
                        "Manual review is unnecessary",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "interview",
                    "explanation": "Bias checks protect both candidates and the company from discriminatory outcomes.",
                    "skill": "Responsible AI",
                },
                {
                    "question": "How do you explain log transformation to a non-technical analyst?",
                    "options": [
                        "It breaks the data",
                        "It compresses large values to reduce skew and highlight relative differences",
                        "It converts text to numbers",
                        "It removes null values automatically",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "Log transformation manages heavy-tailed distributions and stabilizes variance.",
                    "skill": "Feature Engineering",
                },
                {
                    "question": "How would you describe the benefit of self-serve analytics to operations managers?",
                    "options": [
                        "It eliminates the need for governance",
                        "It empowers teams to answer day-to-day questions quickly without waiting on central analysts",
                        "It reduces data accuracy",
                        "It guarantees higher revenue",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "interview",
                    "explanation": "Self-serve tools accelerate decision-making by putting trusted metrics in the hands of domain experts.",
                    "skill": "Analytics Enablement",
                },
                {
                    "question": "Explain to product leadership why maintaining a data dictionary matters.",
                    "options": [
                        "It is purely optional",
                        "It clarifies definitions, owners, and usage of data fields, preventing confusion and errors",
                        "It slows down development",
                        "It replaces the need for dashboards",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "interview",
                    "explanation": "A data dictionary acts as the shared language for analytics assets across teams.",
                    "skill": "Data Governance",
                },
            ]
        ),
        "rapid": _multi_mode_questions(
            [
                {
                    "question": "Rapid triage: a critical dashboard shows 'No Data' after a scheduled ETL run. First step?",
                    "options": [
                        "Wait until the next run",
                        "Check ETL logs and upstream sources for failures or schema changes",
                        "Delete the dashboard",
                        "Rebuild the warehouse",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Investigate pipeline logs and source availability to restore the data feed quickly.",
                    "skill": "Data Engineering",
                },
                {
                    "question": "Rapid response: pipeline metrics show a sudden spike in duplicate records. First mitigation?",
                    "options": [
                        "Ignore the duplicates",
                        "Enable deduplication logic or enforce primary keys before publishing data",
                        "Increase dashboard cache interval",
                        "Pause all modeling work",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Address data duplication at ingestion or transformation steps to prevent downstream contamination.",
                    "skill": "Data Quality",
                },
                {
                    "question": "Rapid drill: an important SQL query suddenly times out. What do you check first?",
                    "options": [
                        "Increase visualization colors",
                        "Review recent query plan changes, missing indexes, or data volume growth",
                        "Disable monitoring",
                        "Switch BI tools",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Query timeouts often trace back to schema or plan regressions; inspect query plans and data size.",
                    "skill": "Data Engineering",
                },
                {
                    "question": "Rapid fix: scheduled forecast report shows wildly unrealistic numbers after a code change. Immediate response?",
                    "options": [
                        "Publish the report anyway",
                        "Roll back the change and validate input data before re-running",
                        "Disable alerts",
                        "Switch to last month's forecast",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Rolling back and validating inputs prevents misinforming stakeholders while debugging the root cause.",
                    "skill": "Analytics Operations",
                },
                {
                    "question": "Rapid response: segment-level churn metric drops to zero overnight. First diagnostic?",
                    "options": [
                        "Assume customers stopped leaving",
                        "Inspect filters, joins, or data freshness for that segment in the pipeline",
                        "Increase visualization opacity",
                        "Retrain all models immediately",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Sudden zeros often indicate filters or pipeline issues, not real-world changes.",
                    "skill": "Analytics Operations",
                },
                {
                    "question": "Rapid triage: an ingestion job started failing after a partner added new columns. What’s your first move?",
                    "options": [
                        "Ignore the new columns",
                        "Update schema mappings or enable schema evolution to handle additions safely",
                        "Delete the partner feed",
                        "Disable schema validation",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Adjust schemas or contracts to accommodate changes and get the data flowing again.",
                    "skill": "Data Engineering",
                },
                {
                    "question": "Rapid scenario: anomaly detection flags a revenue dip caused by missing transactions. First check?",
                    "options": [
                        "Rewrite the anomaly algorithm",
                        "Verify data ingestion completeness and reconciling logs from source systems",
                        "Disable anomaly detection",
                        "Adjust visualization colors",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Ensure transactional feeds are complete before investigating algorithmic issues.",
                    "skill": "Data Quality",
                },
                {
                    "question": "Rapid response: BI dashboard refresh duration spikes from minutes to hours. Immediate next step?",
                    "options": [
                        "Reduce chart count",
                        "Profile queries and materialize heavy aggregations or introduce incremental refreshes",
                        "Ignore the alert",
                        "Switch to spreadsheets",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Optimizing expensive queries or precomputing aggregates restores performance quickly.",
                    "skill": "Analytics Engineering",
                },
                {
                    "question": "Rapid fix: transformation tests fail because of unexpected nulls in a new column. First action?",
                    "options": [
                        "Remove the tests",
                        "Update validation rules to handle nulls and coordinate with source owners on fill strategy",
                        "Deploy anyway",
                        "Change the BI tool",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Handle nulls explicitly and collaborate with data providers to determine expected behavior.",
                    "skill": "Data Quality",
                },
                {
                    "question": "Rapid response: data science models consume a table that suddenly doubled in size. First priority?",
                    "options": [
                        "Disable logging",
                        "Assess partitioning and query strategies to avoid blown compute budgets",
                        "Retrain all models blindly",
                        "Switch clouds",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Optimizing partitions and queries prevents runaway costs and latency.",
                    "skill": "Data Engineering",
                },
                {
                    "question": "Rapid drill: stakeholder complains that weekly KPIs haven't updated. First diagnostic?",
                    "options": [
                        "Assume no activity occurred",
                        "Check pipeline scheduler status, job runs, and data freshness monitors",
                        "Archive the KPIs",
                        "Rebuild the model",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "rapid",
                    "explanation": "Delays often stem from paused pipelines or scheduling failures—verify job status and data freshness.",
                    "skill": "Analytics Operations",
                },
                {
                    "question": "Rapid response: a compliance team flags personal data exposure in analytics tables. First mitigation?",
                    "options": [
                        "Ignore; it's analytics data",
                        "Mask or tokenize sensitive fields immediately and restrict access until scrubbed",
                        "Delete the warehouse",
                        "Disable monitoring",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Protect sensitive data instantly, then plan a permanent fix and review access controls.",
                    "skill": "Data Governance",
                },
                {
                    "question": "Rapid triage: cron-based data pipelines collide, causing resource contention. Quick fix?",
                    "options": [
                        "Ignore the contention",
                        "Stagger schedules or migrate pipelines to orchestration with dependency management",
                        "Increase chart refresh rate",
                        "Disable orchestrators",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Coordinated scheduling prevents job collisions and maintains throughput.",
                    "skill": "Data Engineering",
                },
                {
                    "question": "Rapid response: metrics warehouse shows inconsistent totals across tables. First investigation?",
                    "options": [
                        "Assume a visualization bug",
                        "Trace data lineage and compare transformation logic across the inconsistent tables",
                        "Delete one table",
                        "Turn off caching",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Differences often stem from transformation discrepancies; lineage analysis surfaces the gap.",
                    "skill": "Data Governance",
                },
                {
                    "question": "Rapid scenario: a machine learning feature table hasn't updated for two days. What now?",
                    "options": [
                        "Retrain with stale features",
                        "Investigate upstream ingestion, then backfill missing partitions before models consume it",
                        "Disable monitoring",
                        "Shrink the dataset",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Fresh features are critical; resolve ingestion issues and backfill to avoid degraded predictions.",
                    "skill": "Data Platforms",
                },
                {
                    "question": "Rapid fix: anomalies appear in revenue metrics after timezone adjustments. First check?",
                    "options": [
                        "Rewrite the anomaly algorithm",
                        "Validate timezone conversions in ETL and ensure consistent aggregation windows",
                        "Lower chart resolution",
                        "Retrain churn models",
                    ],
                    "answer": 1,
                    "difficulty": "intermediate",
                    "mode": "rapid",
                    "explanation": "Timezone handling can double-count or shift transactions; verify conversions.",
                    "skill": "Data Engineering",
                },
                {
                    "question": "Rapid response: Data catalog shows stale documentation for critical tables. Immediate action?",
                    "options": [
                        "Ignore documentation",
                        "Engage data owners to update definitions and set reminders for regular reviews",
                        "Delete the catalog",
                        "Disable catalog access",
                    ],
                    "answer": 1,
                    "difficulty": "beginner",
                    "mode": "rapid",
                    "explanation": "Keeping documentation current avoids misinterpretation and ensures compliance.",
                    "skill": "Data Governance",
                },
                {
                    "question": "Rapid triage: ingestion backlog grows rapidly after a new partner integration. First step?",
                    "options": [
                        "Stop onboarding partners",
                        "Scale ingestion resources and coordinate burst windows with the partner",
                        "Disable retry logic",
                        "Switch to CSV exports",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Scaling ingestion and aligning schedules prevents backlog while integrating new feeds.",
                    "skill": "Data Engineering",
                },
                {
                    "question": "Rapid response: data scientists complain about inconsistent metric definitions across teams. What do you do?",
                    "options": [
                        "Tell them to adapt",
                        "Facilitate a metrics council to standardize definitions and publish them in a catalog",
                        "Disable experimentation",
                        "Switch BI platforms",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Governance and shared definitions resolve inconsistencies and build trust in metrics.",
                    "skill": "Data Governance",
                },
                {
                    "question": "Rapid fix: Notebook-driven pipeline accidentally overwrote production tables. Immediate mitigation?",
                    "options": [
                        "Keep running the notebook",
                        "Restore from backups, apply access controls, and migrate to governed pipelines",
                        "Delete all notebooks",
                        "Ignore the issue",
                    ],
                    "answer": 1,
                    "difficulty": "advanced",
                    "mode": "rapid",
                    "explanation": "Restoring data and hardening processes prevents recurrence of destructive manual operations.",
                    "skill": "Analytics Engineering",
                },
            ]
        ),
    },
    "Cybersecurity": [
        _question(
            "What is the primary purpose of a firewall?",
            [
                "Encrypt all traffic end-to-end",
                "Block unauthorized access between trusted and untrusted networks",
                "Manage user passwords centrally",
                "Accelerate network routing",
            ],
            1,
            difficulty="beginner",
            mode="concept",
            explanation="Firewalls inspect and filter traffic to prevent unauthorized access to internal resources.",
            skill="Network Security",
        ),
        _question(
            "Which protocol secures HTTP traffic over the internet?",
            ["HTTP", "FTP", "HTTPS", "Telnet"],
            2,
            difficulty="beginner",
            mode="concept",
            explanation="HTTPS combines HTTP with TLS encryption, protecting data in transit.",
            skill="Web Security",
        ),
        _question(
            "What is the least privilege principle?",
            [
                "Grant every user admin access",
                "Give users only the permissions necessary for their role",
                "Disable auditing to save storage",
                "Share credentials across teams to improve speed",
            ],
            1,
            difficulty="beginner",
            mode="concept",
            explanation="Least privilege minimizes risk by limiting access to what is strictly required to perform a task.",
            skill="Access Management",
        ),
        _question(
            "Which security control detects malicious activity by analyzing host or network events in real time?",
            ["WAF", "SIEM", "Load balancer", "Proxy"],
            1,
            difficulty="beginner",
            mode="concept",
            explanation="A SIEM aggregates and correlates event data, detecting threats in real time.",
            skill="Monitoring",
        ),
        _question(
            "Interview scenario: explain a zero-day vulnerability.",
            [
                "A vulnerability with a known patch",
                "An unknown flaw with no fix yet available",
                "Outdated antivirus signatures",
                "An intentional backdoor",
            ],
            1,
            difficulty="intermediate",
            mode="interview",
            explanation="Zero-days are newly discovered vulnerabilities without patches, representing high risk until remediation.",
            skill="Threat Intelligence",
        ),
        _question(
            "During an interview, how do you differentiate IDS from IPS?",
            [
                "IDS only blocks attacks, IPS only monitors",
                "IDS detects and alerts, IPS can actively block malicious traffic",
                "IDS encrypts data, IPS decrypts",
                "They are interchangeable terms",
            ],
            1,
            difficulty="intermediate",
            mode="interview",
            explanation="An IDS monitors and alerts on suspicious activity, while an IPS can enforce blocking policies inline.",
            skill="Network Security",
        ),
        _question(
            "Which authentication factor does a hardware token fall under?",
            [
                "Something you know",
                "Something you have",
                "Something you are",
                "Somewhere you are",
            ],
            1,
            difficulty="beginner",
            mode="concept",
            explanation="Hardware tokens are 'something you have' within multi-factor authentication schemes.",
            skill="Identity & Access Management",
        ),
        _question(
            "Rapid reaction: SIEM shows a spike in 403 responses right after a deploy. First action?",
            [
                "Disable the SIEM to reduce noise",
                "Correlate deploy changes with WAF or access control updates",
                "Immediately roll back without investigation",
                "Ignore the alerts for 24 hours",
            ],
            1,
            difficulty="advanced",
            mode="rapid",
            explanation="Investigating configuration changes around the deploy helps determine whether the spike is misconfiguration or attack.",
            skill="Incident Response",
        ),
        _question(
            "Rapid incident: a phishing campaign has compromised multiple endpoints. First containment step?",
            [
                "Notify marketing",
                "Quarantine affected devices and reset credentials",
                "Disable the IDS",
                "Increase network MTU",
            ],
            1,
            difficulty="advanced",
            mode="rapid",
            explanation="Containing compromised machines and resetting credentials reduces attacker foothold.",
            skill="Incident Response",
        ),
        _question(
            "Which tool automates compliance checks against hardened baselines?",
            ["Vulnerability scanner", "Infrastructure as code", "Configuration compliance scanner", "Penetration testing toolkit"],
            2,
            difficulty="intermediate",
            mode="concept",
            explanation="Compliance scanners compare systems against baselines (e.g., CIS benchmarks) to flag deviations.",
            skill="Governance",
        ),
        _question(
            "Interview prompt: how would you explain defense in depth?",
            [
                "Using a single strong firewall",
                "Layering multiple security controls so if one fails, others still protect",
                "Disabling all unnecessary services",
                "Relying solely on antivirus",
            ],
            1,
            difficulty="intermediate",
            mode="interview",
            explanation="Defense in depth combines numerous controls across network, host, and application layers to minimize risk.",
            skill="Security Architecture",
        ),
        _question(
            "Which best describes a honeypot?",
            [
                "A high-value production system",
                "A decoy system designed to lure attackers",
                "An encryption algorithm",
                "A load balancer",
            ],
            1,
            difficulty="intermediate",
            mode="concept",
            explanation="Honeypots attract attackers to monitor techniques and divert them from real assets.",
            skill="Threat Hunting",
        ),
        _question(
            "Rapid fix: A TLS certificate expires on a critical API. Immediate action?",
            [
                "Disable HTTPS temporarily",
                "Swap to a new certificate and update the trust store",
                "Ignore the issue",
                "Rollback to HTTP only",
            ],
            1,
            difficulty="advanced",
            mode="rapid",
            explanation="Provisioning a new certificate and updating dependencies restores secure communication quickly.",
            skill="Operational Security",
        ),
        _question(
            "What is the first step in a formal incident response process?",
            [
                "Eradication",
                "Containment",
                "Preparation",
                "Recovery",
            ],
            2,
            difficulty="beginner",
            mode="concept",
            explanation="Preparation ensures processes, tooling, and people are ready before incidents occur.",
            skill="Incident Response",
        ),
        _question(
            "Which attack abuses human psychology to obtain sensitive information?",
            ["SQL injection", "Social engineering", "Cross-site scripting", "Denial of service"],
            1,
            difficulty="beginner",
            mode="concept",
            explanation="Social engineering manipulates people into revealing information or performing risky actions.",
            skill="Security Awareness",
        ),
        _question(
            "Which technique helps detect lateral movement inside a network?",
            [
                "Deploying honeynets and East-West traffic monitoring",
                "Increasing CPU quotas",
                "Disabling DNS logging",
                "Reducing MFA prompts",
            ],
            0,
            difficulty="advanced",
            mode="concept",
            explanation="Monitoring East-West traffic and deploying honeynets helps uncover lateral movement attempts by attackers.",
            skill="Threat Hunting",
        ),
        _question(
            "Interview prompt: how would you justify implementing zero trust?",
            [
                "It removes the need for monitoring",
                "It assumes no implicit trust and enforces continuous verification",
                "It is cheaper than firewalls",
                "It replaces identity providers",
            ],
            1,
            difficulty="advanced",
            mode="interview",
            explanation="Zero trust ensures that every user and device is continuously verified, limiting the scope of compromise.",
            skill="Security Architecture",
        ),
        _question(
            "Rapid: You discover plaintext secrets in a build pipeline. Immediate step?",
            [
                "Ignore because the network is private",
                "Rotate the credentials and store them in a vault",
                "Document them in a runbook",
                "Add them to a shared spreadsheet",
            ],
            1,
            difficulty="advanced",
            mode="rapid",
            explanation="Rotating exposed secrets and moving them into secure secret management is the priority before redeploying.",
            skill="DevSecOps",
        ),
        _question(
            "Which control helps ensure software supply chain integrity?",
            [
                "Relying on self-signed certificates",
                "Implementing signed artifacts and provenance checks",
                "Turning off code scanning",
                "Allowing direct commits to production",
            ],
            1,
            difficulty="advanced",
            mode="concept",
            explanation="Signed artifacts and provenance checks help verify that software hasn’t been tampered with in the supply chain.",
            skill="Supply Chain Security",
        ),
        _question(
            "Interview: how do you convey the importance of logging and monitoring?",
            [
                "They slow down systems but are optional",
                "They provide the visibility required to detect and respond to threats quickly",
                "They make compliance easier but add no security value",
                "They replace the need for firewalls",
            ],
            1,
            difficulty="intermediate",
            mode="interview",
            explanation="Logs and monitoring underpin detection, triage, and post-incident analysis, making them critical to cyber defense.",
            skill="Monitoring",
        ),
        _question(
            "Rapid drill: MFA outages are preventing partner logins. First step?",
            [
                "Disable MFA for everyone",
                "Fail over to a secondary MFA provider or backup codes",
                "Tell partners to wait",
                "Move to a weaker password policy",
            ],
            1,
            difficulty="advanced",
            mode="rapid",
            explanation="Having MFA redundancy—backup providers or codes—keeps access secure while resolving the primary outage.",
            skill="Identity & Access Management",
        ),
    ],
}


def _normalize_domain(domain: str) -> str:
    mapping = {
        "ai/ml": "AI/ML",
        "aiml": "AI/ML",
        "ai ml": "AI/ML",
        "cybersecurity": "Cybersecurity",
        "data science": "Data Science",
        "datascience": "Data Science",
        "web development": "Web Development",
        "web": "Web Development",
        "cloud": "Cloud Computing",
        "cloud computing": "Cloud Computing",
        "iot": "IoT",
        "robotics": "Robotics",
    }
    key = domain.strip().lower()
    return mapping.get(key, domain)


def _filter_questions(domain: str, mode: str, difficulty: str) -> List[Dict[str, Any]]:
    bank_by_domain = _QUESTION_BANK.get(domain, {})
    mode_bank = bank_by_domain.get(mode, [])

    filtered = [q.copy() for q in mode_bank if q["difficulty"] == difficulty]
    if filtered:
        return filtered

    filtered = [q.copy() for q in mode_bank if q["difficulty"] != difficulty]
    if filtered:
        return filtered

    all_mode_questions = [q.copy() for questions in bank_by_domain.values() for q in questions if q["difficulty"] == difficulty]
    if all_mode_questions:
        return all_mode_questions

    filtered = [q.copy() for questions in bank_by_domain.values() for q in questions]
    if filtered:
        return filtered
    return []


@router.get("/quiz")
async def get_quiz(
    domain: str = Query(..., description="Domain e.g. AI/ML, Data Science"),
    difficulty: str = Query("intermediate", regex="^(beginner|intermediate|advanced)$"),
    mode: str = Query("concept", regex="^(concept|interview|rapid)$"),
    limit: int = Query(20, ge=1, le=20),
    user: User = Depends(get_current_user),
):
    domain_norm = _normalize_domain(domain)
    bank = _filter_questions(domain_norm, mode, difficulty)

    if not bank:
        raise HTTPException(status_code=404, detail=f"No questions available for domain: {domain_norm}")

    selected = bank if len(bank) <= limit else sample(bank, limit)

    items = []
    for q in selected:
        options = q["options"].copy()
        correct_label = options[q["answer"]]
        shuffle(options)
        items.append(
            {
                "id": q["id"],
                "question": q["question"],
                "options": options,
                "answer": options.index(correct_label),
                "explanation": q["explanation"],
                "skill": q["skill"],
            }
        )

    settings = DIFFICULTY_SETTINGS.get(difficulty, DIFFICULTY_SETTINGS["intermediate"])

    return {
        "domain": domain_norm,
        "mode": mode,
        "difficulty": difficulty,
        "total_questions": len(items),
        "items": items,
        "meta": {
            "time_per_question": settings["time_per_question"],
            "points_per_correct": settings["points"],
            "total_available": len(bank),
        },
    }


@router.post("/quiz/submit")
async def submit_quiz(
    payload: Dict[str, Any],
    user: User = Depends(get_current_user),
    db: Session = Depends(get_db),
):
    required = {"domain", "mode", "difficulty", "score", "total_questions", "responses"}
    if not required.issubset(payload):
        raise HTTPException(status_code=400, detail="Missing required fields in payload.")

    domain = _normalize_domain(payload["domain"])
    responses: List[Dict[str, Any]] = payload["responses"]

    correct_skills = []
    weak_skills = []
    correct_flags = []
    for r in responses:
        is_correct = bool(r.get("correct"))
        correct_flags.append(is_correct)
        skill_name = r.get("skill")
        if is_correct and skill_name:
            correct_skills.append(skill_name)
        elif not is_correct and skill_name:
            weak_skills.append(skill_name)

    difficulty_key = payload["difficulty"].lower()
    settings = DIFFICULTY_SETTINGS.get(difficulty_key, DIFFICULTY_SETTINGS["intermediate"])
    points_per_correct = settings["points"]

    correct_count = sum(1 for flag in correct_flags if flag)
    base_points = correct_count * points_per_correct

    streak = 0
    max_streak = 0
    for flag in correct_flags:
        if flag:
            streak += 1
            max_streak = max(max_streak, streak)
        else:
            streak = 0
    streak_bonus = max(0, (max_streak - 1) * 5)

    total_points = base_points + streak_bonus
    xp_gain = max(10, total_points // 2 if total_points else int(payload["score"]))

    total_time_taken = int(payload.get("total_time_taken", 0) or 0)

    progress = db.query(Progress).filter(Progress.user_id == user.id).first()
    if not progress:
        progress = Progress(user_id=user.id, data={})
        db.add(progress)
        db.flush()

    data = progress.data or {}
    data.setdefault("xp", 0)
    data["xp"] += xp_gain

    badges = set(data.get("badges", []))
    if payload["score"] == 100:
        badges.add("Quiz Ace")
    if payload["score"] >= 80:
        badges.add("Quiz Expert")

    history = data.get("quiz_history", [])
    history.append(
        {
            "domain": domain,
            "mode": payload["mode"],
            "difficulty": payload["difficulty"],
            "score": payload["score"],
            "total": payload["total_questions"],
            "timestamp": datetime.utcnow().isoformat(),
        }
    )

    data["badges"] = list(badges)
    data["quiz_history"] = history[-20:]
    progress.data = data
    db.commit()
    db.refresh(progress)

    strengths = sorted(set(correct_skills))
    weaknesses = sorted(set(weak_skills))

    recommendations = []
    for skill in weaknesses[:3]:
        recs = get_resources(domain, skill)
        if recs:
            recommendations.append({"skill": skill, "resources": recs[:2]})

    roadmap = get_learning_path(domain) or {}
    suggested_steps = roadmap.get("steps", [])[:3]

    return {
        "awarded_xp": xp_gain,
        "total_xp": progress.data.get("xp", xp_gain),
        "badges": progress.data.get("badges", []),
        "strengths": strengths,
        "weaknesses": weaknesses,
        "recommendations": recommendations,
        "suggested_next_steps": suggested_steps,
        "total_points": total_points,
        "streak_bonus": streak_bonus,
        "max_streak": max_streak,
        "time_spent_seconds": total_time_taken,
        "points_per_correct": points_per_correct,
    }
